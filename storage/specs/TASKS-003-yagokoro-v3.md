# タスク分解書: YAGOKORO v3.0.0

**Document ID**: TASKS-003
**Version**: 1.0.0
**Created**: 2025-12-31
**Updated**: 2025-12-31
**Status**: Draft
**Related Requirements**: REQ-003
**Related Design**: DES-003

---

## 1. タスク概要

### 1.1 プロジェクト目標

YAGOKORO v3.0.0 は以下の6つの主要機能を追加します：

1. **Phase 1**: 論文自動取り込み（F-002）- 他機能の入力データ生成
2. **Phase 2**: 自動関係抽出（F-001）- F-002の出力を処理
3. **Phase 3**: MCPツール拡張（F-003）+ HITL検証（F-004）- 並行実施
4. **Phase 4**: 差分更新（F-005）
5. **Phase 5**: クエリキャッシュ（F-006）
6. **Phase 6**: 統合テスト・ドキュメント

### 1.2 スプリント計画

| Sprint | 期間 | 目標 | 主要成果物 |
|--------|------|------|-----------|
| Sprint 1 | Week 1-2 | Phase 1: 論文取り込み | libs/ingestion |
| Sprint 2 | Week 3-5 | Phase 2: 自動関係抽出 | libs/extractor |
| Sprint 3 | Week 6-7 | Phase 3: MCP + HITL | libs/mcp拡張, libs/hitl |
| Sprint 4 | Week 8-9 | Phase 4: 差分更新 | libs/pipeline |
| Sprint 5 | Week 10-11 | Phase 5: キャッシュ | libs/cache |
| Sprint 6 | Week 12 | Phase 6: 統合・バッファ | E2Eテスト、ドキュメント |

### 1.3 優先度定義

| 優先度 | 説明 | 対応要件 |
|--------|------|----------|
| P0 | ブロッカー（後続タスクの前提） | F-001, F-002, F-003 |
| P1 | 高優先度（Sprint内で完了必須） | F-004, F-005 |
| P2 | 中優先度（Sprint内で完了推奨） | F-006 |
| P3 | 低優先度（時間があれば実施） | Nice-to-have |

### 1.4 見積もりサマリー

| Phase | タスク数 | 合計見積もり |
|-------|----------|--------------|
| Phase 1: 論文取り込み | 8 | 40h |
| Phase 2: 自動関係抽出 | 10 | 50h |
| Phase 3: MCP + HITL | 12 | 48h |
| Phase 4: 差分更新 | 8 | 32h |
| Phase 5: キャッシュ | 6 | 24h |
| Phase 6: 統合テスト | 6 | 24h |
| **合計** | **50** | **218h** |

### 1.5 依存関係図

```
Phase 1 (論文取り込み)
    │
    ▼
Phase 2 (自動関係抽出)
    │
    ├─────────────────┐
    ▼                 ▼
Phase 3a (MCP)    Phase 3b (HITL)  ← 並行実施
    │                 │
    └────────┬────────┘
             ▼
Phase 4 (差分更新)
             │
             ▼
Phase 5 (キャッシュ)
             │
             ▼
Phase 6 (統合テスト)
```

---

## 2. Sprint 1: Phase 1 - 論文自動取り込み

### TASK-V3-001: ingestion パッケージ初期化

**優先度**: P0
**見積もり**: 2h
**担当**: -
**要件ID**: F-002（基盤）
**設計参照**: DES-003 §2.3.2

#### 説明
`libs/ingestion` パッケージを新規作成し、基本構造を整備する。

#### 受入条件
- [ ] `libs/ingestion/package.json` が作成されている
- [ ] `libs/ingestion/tsconfig.json` が作成されている
- [ ] `libs/ingestion/vitest.config.ts` が作成されている
- [ ] ディレクトリ構造（arxiv/, semantic-scholar/, dedup/, scheduler/）が作成されている
- [ ] `pnpm build` が成功する

#### サブタスク
- [ ] package.json 作成（依存: axios, node-cron, zod）
- [ ] tsconfig.json 作成
- [ ] vitest.config.ts 作成
- [ ] src/index.ts 作成（エクスポート定義）
- [ ] ディレクトリ構造作成

---

### TASK-V3-002: ArxivClient 実装

**優先度**: P0
**見積もり**: 6h
**担当**: -
**要件ID**: REQ-003-005
**設計参照**: DES-003 §2.3.2, §4.2.2

#### 説明
arXiv OAI-PMH APIクライアントを実装する。3秒間隔のレート制限を遵守。

#### 受入条件
- [ ] ArxivClient クラスが実装されている
- [ ] カテゴリフィルタ（cs.AI, cs.CL, cs.LG, cs.CV, cs.NE）が動作する
- [ ] 日付範囲クエリが動作する
- [ ] レート制限（3秒間隔）が実装されている
- [ ] テスト10件以上

#### サブタスク
- [ ] ArxivClient クラス作成
- [ ] OAI-PMH API呼び出し実装
- [ ] XMLパーサー実装
- [ ] RateLimiter実装（Token Bucket）
- [ ] 単体テスト作成

---

### TASK-V3-003: SemanticScholarClient 実装

**優先度**: P1
**見積もり**: 6h
**担当**: -
**要件ID**: REQ-003-006
**設計参照**: DES-003 §2.3.2

#### 説明
Semantic Scholar REST APIクライアントを実装する。100リクエスト/5分のレート制限を遵守。

#### 受入条件
- [ ] SemanticScholarClient クラスが実装されている
- [ ] 引用数・被引用論文リスト取得が動作する
- [ ] 著者情報取得が動作する
- [ ] レート制限（100req/5min）が実装されている
- [ ] Circuit Breakerが実装されている
- [ ] テスト10件以上

#### サブタスク
- [ ] SemanticScholarClient クラス作成
- [ ] REST API呼び出し実装
- [ ] RateLimiter実装（Sliding Window）
- [ ] CircuitBreaker実装
- [ ] Fallback処理実装
- [ ] 単体テスト作成

---

### TASK-V3-004: Deduplicator 実装

**優先度**: P0
**見積もり**: 4h
**担当**: -
**要件ID**: REQ-003-007
**設計参照**: DES-003 §2.3.2

#### 説明
論文の重複検出機能を実装する。DOI完全一致、タイトル類似度、著者マッチングで判定。

#### 受入条件
- [ ] Deduplicator クラスが実装されている
- [ ] DOI完全一致で重複判定できる
- [ ] タイトル類似度（閾値0.95）で重複候補を検出できる
- [ ] 著者3名以上一致 + タイトル類似度0.8以上で重複候補を検出できる
- [ ] テスト10件以上

#### サブタスク
- [ ] Deduplicator クラス作成
- [ ] DOIマッチング実装
- [ ] タイトル類似度計算（Levenshtein）実装
- [ ] 著者マッチング実装
- [ ] 単体テスト作成

---

### TASK-V3-005: ScheduleRunner 実装

**優先度**: P1
**見積もり**: 4h
**担当**: -
**要件ID**: REQ-003-008
**設計参照**: DES-003 §2.3.2

#### 説明
スケジュール実行機能を実装する。Cron式対応、失敗リトライ機能付き。

#### 受入条件
- [ ] ScheduleRunner クラスが実装されている
- [ ] Cron式でスケジュール設定できる
- [ ] デフォルト6時間間隔で実行される
- [ ] 失敗時のリトライ（Exponential Backoff）が動作する
- [ ] テスト5件以上

#### サブタスク
- [ ] ScheduleRunner クラス作成
- [ ] node-cron統合
- [ ] リトライロジック実装
- [ ] 単体テスト作成

---

### TASK-V3-006: IngestionService 実装

**優先度**: P0
**見積もり**: 6h
**担当**: -
**要件ID**: F-002
**設計参照**: DES-003 §4.2.2

#### 説明
論文取り込みサービスを統合実装する。ArxivClient、SemanticScholarClient、Deduplicator、ScheduleRunnerを統合。

#### 受入条件
- [ ] IngestionService クラスが実装されている
- [ ] `ingestFromArxiv()` が動作する
- [ ] `ingestFromSemanticScholar()` が動作する
- [ ] `scheduleIngestion()` が動作する
- [ ] `getIngestionStatus()` が動作する
- [ ] 統合テスト5件以上

#### サブタスク
- [ ] IngestionService クラス作成
- [ ] コンポーネント統合
- [ ] ステータス管理実装
- [ ] 統合テスト作成

---

### TASK-V3-007: Paper エンティティ拡張

**優先度**: P0
**見積もり**: 4h
**担当**: -
**要件ID**: F-002
**設計参照**: DES-003 §3.1

#### 説明
@yagokoro/domain に Paper エンティティを追加し、Neo4jスキーマを更新する。

#### 受入条件
- [ ] Paper インターフェースが定義されている
- [ ] ProcessingStatus 型が定義されている
- [ ] Neo4j スキーマ更新スクリプトが作成されている
- [ ] 既存データとの互換性が確保されている
- [ ] テスト5件以上

#### サブタスク
- [ ] Paper インターフェース定義
- [ ] ProcessingStatus 型定義
- [ ] Neo4j マイグレーションスクリプト作成
- [ ] 単体テスト作成

---

### TASK-V3-008: Sprint 1 統合テスト

**優先度**: P1
**見積もり**: 8h
**担当**: -
**要件ID**: F-002
**設計参照**: DES-003 §5.1

#### 説明
Phase 1 の統合テストを実施。論文取り込みパイプライン全体の動作を検証。

#### 受入条件
- [ ] E2Eテスト: arXiv → 重複チェック → Neo4j保存 が動作する
- [ ] E2Eテスト: スケジュール実行が動作する
- [ ] エラーケーステスト: API障害時のフォールバック
- [ ] パフォーマンステスト: 100件/時間の取り込み
- [ ] テスト合計20件以上

#### サブタスク
- [ ] E2Eテストケース作成
- [ ] エラーケーステスト作成
- [ ] パフォーマンステスト作成
- [ ] CI/CD統合

---

## 3. Sprint 2: Phase 2 - 自動関係抽出

### TASK-V3-009: extractor パッケージ初期化

**優先度**: P0
**見積もり**: 2h
**担当**: -
**要件ID**: F-001（基盤）
**設計参照**: DES-003 §2.3.1

#### 説明
`libs/extractor` パッケージを新規作成し、基本構造を整備する。

#### 受入条件
- [ ] `libs/extractor/package.json` が作成されている
- [ ] `libs/extractor/tsconfig.json` が作成されている
- [ ] `libs/extractor/vitest.config.ts` が作成されている
- [ ] ディレクトリ構造（cooccurrence/, pattern/, scorer/, service/）が作成されている
- [ ] `pnpm build` が成功する

#### サブタスク
- [ ] package.json 作成
- [ ] tsconfig.json 作成
- [ ] vitest.config.ts 作成
- [ ] ディレクトリ構造作成

---

### TASK-V3-010: CooccurrenceAnalyzer 実装

**優先度**: P0
**見積もり**: 8h
**担当**: -
**要件ID**: REQ-003-001
**設計参照**: DES-003 §2.3.1, §4.2.1

#### 説明
同一文書内でのエンティティ共起を検出する分析器を実装する。

#### 受入条件
- [ ] CooccurrenceAnalyzer クラスが実装されている
- [ ] 文書レベルの共起検出が動作する
- [ ] 段落レベルの共起検出が動作する
- [ ] 文レベルの共起検出が動作する
- [ ] 共起回数と文書数をメタデータとして記録できる
- [ ] 処理速度: 1000文書/分以上
- [ ] テスト15件以上

#### サブタスク
- [ ] CooccurrenceAnalyzer クラス作成
- [ ] テキスト分割（文書/段落/文）実装
- [ ] エンティティ検出実装
- [ ] 共起ペア生成実装
- [ ] メタデータ記録実装
- [ ] パフォーマンス最適化
- [ ] 単体テスト作成

---

### TASK-V3-011: PatternMatcher 実装

**優先度**: P0
**見積もり**: 6h
**担当**: -
**要件ID**: REQ-003-002
**設計参照**: DES-003 §2.3.1

#### 説明
動詞パターンと依存構造を解析して関係タイプを推論する。

#### 受入条件
- [ ] PatternMatcher クラスが実装されている
- [ ] 動詞パターンマッチングが動作する
- [ ] 8種類の関係タイプを推論できる
- [ ] テンプレートベースのマッチングが動作する
- [ ] テスト10件以上

#### サブタスク
- [ ] PatternMatcher クラス作成
- [ ] 動詞パターン辞書作成
- [ ] パターンマッチングロジック実装
- [ ] 関係タイプマッピング実装
- [ ] 単体テスト作成

---

### TASK-V3-012: RelationScorer 実装

**優先度**: P0
**見積もり**: 6h
**担当**: -
**要件ID**: REQ-003-003
**設計参照**: DES-003 §2.3.1

#### 説明
関係の信頼度スコアを計算する。共起頻度、LLM確信度、ソース信頼性、グラフ整合性を加重平均。

#### 受入条件
- [ ] RelationScorer クラスが実装されている
- [ ] 4要素の加重平均（0.3, 0.3, 0.2, 0.2）でスコア計算できる
- [ ] スコア0.7以上を自動承認候補としてマークできる
- [ ] スコア0.5-0.7をHITLレビュー対象としてマークできる
- [ ] スコア0.5未満を棄却できる
- [ ] テスト10件以上

#### サブタスク
- [ ] RelationScorer クラス作成
- [ ] 共起頻度スコア計算実装
- [ ] LLM確信度取得実装
- [ ] ソース信頼性評価実装
- [ ] グラフ整合性チェック実装
- [ ] 加重平均計算実装
- [ ] 単体テスト作成

---

### TASK-V3-013: ContradictionDetector 実装

**優先度**: P0
**見積もり**: 4h
**担当**: -
**要件ID**: REQ-003-004
**設計参照**: DES-003 §2.3.1

#### 説明
推論された関係が既存知識グラフと矛盾するかを検出する。

#### 受入条件
- [ ] ContradictionDetector クラスが実装されている
- [ ] 矛盾検出率95%以上
- [ ] 矛盾理由をログに記録できる
- [ ] HITLレビューキューに追加できる
- [ ] テスト10件以上

#### サブタスク
- [ ] ContradictionDetector クラス作成
- [ ] 既存関係との比較ロジック実装
- [ ] 矛盾パターン定義
- [ ] ログ記録実装
- [ ] 単体テスト作成

---

### TASK-V3-014: LLMRelationInferrer 実装

**優先度**: P0
**見積もり**: 8h
**担当**: -
**要件ID**: REQ-003-002
**設計参照**: DES-003 §4.2.1

#### 説明
LLMを使用して共起ペアの関係タイプを推論する。

#### 受入条件
- [ ] LLMRelationInferrer クラスが実装されている
- [ ] 8種類の関係タイプを推論できる
- [ ] 各推論に信頼度スコア（0.0-1.0）を付与できる
- [ ] 推論根拠をテキストで記録できる
- [ ] Ollama/OpenAI両対応
- [ ] テスト10件以上

#### サブタスク
- [ ] LLMRelationInferrer クラス作成
- [ ] プロンプトテンプレート作成
- [ ] Ollama統合
- [ ] OpenAI統合
- [ ] レスポンスパーサー実装
- [ ] 単体テスト作成

---

### TASK-V3-015: RelationExtractorService 実装

**優先度**: P0
**見積もり**: 6h
**担当**: -
**要件ID**: F-001
**設計参照**: DES-003 §4.2.1

#### 説明
関係抽出サービスを統合実装する。全コンポーネントを統合してパイプラインを構築。

#### 受入条件
- [ ] RelationExtractorService クラスが実装されている
- [ ] `extract(document)` が動作する
- [ ] `extractBatch(documents)` が動作する
- [ ] `analyzeCooccurrence(entities)` が動作する
- [ ] 統合テスト5件以上

#### サブタスク
- [ ] RelationExtractorService クラス作成
- [ ] パイプライン構築
- [ ] バッチ処理実装
- [ ] 統合テスト作成

---

### TASK-V3-016: Relation エンティティ拡張

**優先度**: P0
**見積もり**: 4h
**担当**: -
**要件ID**: F-001
**設計参照**: DES-003 §3.1, §3.2

#### 説明
@yagokoro/domain の Relation エンティティを拡張し、Neo4jスキーマを更新する。

#### 受入条件
- [ ] Relation インターフェースに新規フィールドが追加されている
- [ ] RelationType に5種類の新規タイプが追加されている
- [ ] ReviewStatus 型が定義されている
- [ ] Neo4j スキーマ更新スクリプトが作成されている
- [ ] テスト5件以上

#### サブタスク
- [ ] Relation インターフェース拡張
- [ ] RelationType 拡張
- [ ] ReviewStatus 型定義
- [ ] Neo4j マイグレーションスクリプト作成
- [ ] 単体テスト作成

---

### TASK-V3-017: 関係タイプ設定ファイル

**優先度**: P1
**見積もり**: 2h
**担当**: -
**要件ID**: REQ-003-024
**設計参照**: DES-003 §3.1

#### 説明
関係タイプをYAML/JSON設定ファイルで定義できるようにする。

#### 受入条件
- [ ] 関係タイプ定義ファイル（YAML/JSON）が作成されている
- [ ] 設定ファイルのバリデーションが動作する
- [ ] 新タイプ追加時にLLMプロンプトを自動更新できる
- [ ] テスト5件以上

#### サブタスク
- [ ] 設定ファイルスキーマ定義
- [ ] 設定ファイルローダー実装
- [ ] プロンプト自動更新実装
- [ ] 単体テスト作成

---

### TASK-V3-018: Sprint 2 統合テスト

**優先度**: P1
**見積もり**: 8h
**担当**: -
**要件ID**: F-001
**設計参照**: DES-003 §5

#### 説明
Phase 2 の統合テストを実施。自動関係抽出パイプライン全体の動作を検証。

#### 受入条件
- [ ] E2Eテスト: 文書 → 共起分析 → LLM推論 → スコアリング → 保存 が動作する
- [ ] E2Eテスト: 矛盾検出が動作する
- [ ] パフォーマンステスト: 1000文書/分の処理
- [ ] 関係数が4倍以上に増加することを確認
- [ ] テスト合計20件以上

#### サブタスク
- [ ] E2Eテストケース作成
- [ ] パフォーマンステスト作成
- [ ] 関係数増加検証

---

## 4. Sprint 3: Phase 3 - MCP + HITL

### TASK-V3-019: hitl パッケージ初期化

**優先度**: P1
**見積もり**: 2h
**担当**: -
**要件ID**: F-004（基盤）
**設計参照**: DES-003 §2.3.3

#### 説明
`libs/hitl` パッケージを新規作成し、基本構造を整備する。

#### 受入条件
- [ ] `libs/hitl/package.json` が作成されている
- [ ] ディレクトリ構造（queue/, service/, batch/）が作成されている
- [ ] `pnpm build` が成功する

---

### TASK-V3-020: ReviewQueue 実装

**優先度**: P1
**見積もり**: 4h
**担当**: -
**要件ID**: REQ-003-014
**設計参照**: DES-003 §2.3.3

#### 説明
レビュー対象を管理する優先度キューを実装する。

#### 受入条件
- [ ] ReviewQueue クラスが実装されている
- [ ] 優先度キューが動作する
- [ ] ステータス管理（pending, approved, rejected）が動作する
- [ ] 期限管理が動作する
- [ ] テスト10件以上

---

### TASK-V3-021: ReviewService 実装

**優先度**: P1
**見積もり**: 6h
**担当**: -
**要件ID**: REQ-003-015
**設計参照**: DES-003 §4.2.3

#### 説明
レビュー操作を提供するサービスを実装する。

#### 受入条件
- [ ] ReviewService クラスが実装されている
- [ ] `approve(id)` が動作する
- [ ] `reject(id, reason)` が動作する
- [ ] `approveWithModification(id, modification)` が動作する
- [ ] 履歴記録が動作する
- [ ] テスト10件以上

---

### TASK-V3-022: BatchApprover 実装

**優先度**: P1
**見積もり**: 4h
**担当**: -
**要件ID**: REQ-003-016
**設計参照**: DES-003 §2.3.3

#### 説明
一括承認機能を実装する。閾値以上のアイテムを一括承認。

#### 受入条件
- [ ] BatchApprover クラスが実装されている
- [ ] 信頼度閾値フィルタが動作する
- [ ] アイテムタイプフィルタが動作する
- [ ] 一括承認が動作する
- [ ] テスト5件以上

---

### TASK-V3-023: HITLService 実装

**優先度**: P1
**見積もり**: 4h
**担当**: -
**要件ID**: F-004
**設計参照**: DES-003 §4.2.3

#### 説明
HITLサービスを統合実装する。

#### 受入条件
- [ ] HITLService クラスが実装されている
- [ ] `submitForReview()` が動作する
- [ ] `getPendingReviews()` が動作する
- [ ] `getReviewStats()` が動作する
- [ ] 統合テスト5件以上

---

### TASK-V3-024: NLQツール実装（nlq_query, nlq_history）

**優先度**: P0
**見積もり**: 6h
**担当**: -
**要件ID**: REQ-003-009, REQ-003-010
**設計参照**: DES-003 §4.1

#### 説明
NLQ関連のMCPツールを実装する。

#### 受入条件
- [ ] `nlq_query` ツールが実装されている
- [ ] `nlq_history` ツールが実装されている
- [ ] 日本語/英語両対応
- [ ] テスト10件以上

---

### TASK-V3-025: 推論ツール実装（find_paths, infer_relations）

**優先度**: P0
**見積もり**: 6h
**担当**: -
**要件ID**: REQ-003-011, REQ-003-012
**設計参照**: DES-003 §4.1

#### 説明
推論関連のMCPツールを実装する。

#### 受入条件
- [ ] `find_paths` ツールが実装されている
- [ ] `infer_relations` ツールが実装されている
- [ ] 最大4ホップのパス探索が動作する
- [ ] テスト10件以上

---

### TASK-V3-026: 分析ツール実装（analyze_gaps, analyze_lifecycle）

**優先度**: P0
**見積もり**: 4h
**担当**: -
**要件ID**: REQ-003-013, REQ-003-021
**設計参照**: DES-003 §4.1

#### 説明
分析関連のMCPツールを実装する。

#### 受入条件
- [ ] `analyze_gaps` ツールが実装されている
- [ ] `analyze_lifecycle` ツールが実装されている
- [ ] テスト10件以上

---

### TASK-V3-027: 検証ツール実装（verify_statement, verify_entity）

**優先度**: P0
**見積もり**: 4h
**担当**: -
**要件ID**: REQ-003-025, REQ-003-026
**設計参照**: DES-003 §4.1

#### 説明
検証関連のMCPツールを実装する。

#### 受入条件
- [ ] `verify_statement` ツールが実装されている
- [ ] `verify_entity` ツールが実装されている
- [ ] テスト10件以上

---

### TASK-V3-028: 正規化ツール実装（normalize_entity）

**優先度**: P1
**見積もり**: 2h
**担当**: -
**要件ID**: REQ-003-009
**設計参照**: DES-003 §4.1

#### 説明
正規化関連のMCPツールを実装する。

#### 受入条件
- [ ] `normalize_entity` ツールが実装されている
- [ ] autoApproveオプションが動作する
- [ ] テスト5件以上

---

### TASK-V3-029: MCP manifest更新

**優先度**: P0
**見積もり**: 2h
**担当**: -
**要件ID**: F-003
**設計参照**: DES-003 §4.1

#### 説明
MCPサーバーのmanifest.jsonを更新し、15ツールを公開する。

#### 受入条件
- [ ] manifest.json が更新されている
- [ ] 15ツールすべてが登録されている
- [ ] ツール説明が記載されている
- [ ] Claude/他MCPクライアントで動作確認

---

### TASK-V3-030: Sprint 3 統合テスト

**優先度**: P1
**見積もり**: 6h
**担当**: -
**要件ID**: F-003, F-004
**設計参照**: DES-003 §5.2, §5.3

#### 説明
Phase 3 の統合テストを実施。MCP + HITLの動作を検証。

#### 受入条件
- [ ] E2Eテスト: MCPクライアント → 15ツール が動作する
- [ ] E2Eテスト: 関係抽出 → HITL → 承認/却下 フローが動作する
- [ ] テスト合計20件以上

---

## 5. Sprint 4: Phase 4 - 差分更新

### TASK-V3-031: pipeline パッケージ初期化

**優先度**: P1
**見積もり**: 2h
**担当**: -
**要件ID**: F-005（基盤）
**設計参照**: DES-003 §2.3.4

#### 説明
`libs/pipeline` パッケージを新規作成し、基本構造を整備する。

#### 受入条件
- [ ] `libs/pipeline/package.json` が作成されている
- [ ] ディレクトリ構造（detector/, diff/, batch/, service/）が作成されている
- [ ] `pnpm build` が成功する

---

### TASK-V3-032: ChangeDetector 実装

**優先度**: P1
**見積もり**: 6h
**担当**: -
**要件ID**: REQ-003-017
**設計参照**: DES-003 §2.3.4

#### 説明
変更検知機能を実装する。ハッシュ比較、更新日時比較、バージョン管理。

#### 受入条件
- [ ] ChangeDetector クラスが実装されている
- [ ] ハッシュ比較による変更検知が動作する
- [ ] 更新日時比較が動作する
- [ ] バージョン管理が動作する
- [ ] テスト10件以上

---

### TASK-V3-033: DiffCalculator 実装

**優先度**: P1
**見積もり**: 4h
**担当**: -
**要件ID**: REQ-003-017
**設計参照**: DES-003 §2.3.4

#### 説明
差分計算機能を実装する。追加/更新/削除の差分セット生成。

#### 受入条件
- [ ] DiffCalculator クラスが実装されている
- [ ] 追加/更新/削除の分類が動作する
- [ ] 差分セット生成が動作する
- [ ] 影響範囲特定が動作する
- [ ] テスト10件以上

---

### TASK-V3-034: BatchProcessor 実装

**優先度**: P1
**見積もり**: 4h
**担当**: -
**要件ID**: REQ-003-018
**設計参照**: DES-003 §2.3.4

#### 説明
バッチ処理機能を実装する。チャンク分割、並列処理、トランザクション管理。

#### 受入条件
- [ ] BatchProcessor クラスが実装されている
- [ ] チャンク分割が動作する
- [ ] 並列処理が動作する
- [ ] トランザクション管理が動作する
- [ ] テスト10件以上

---

### TASK-V3-035: PipelineService 実装

**優先度**: P1
**見積もり**: 6h
**担当**: -
**要件ID**: F-005
**設計参照**: DES-003 §4.2.4

#### 説明
パイプラインサービスを統合実装する。

#### 受入条件
- [ ] PipelineService クラスが実装されている
- [ ] `detectChanges()` が動作する
- [ ] `applyChanges()` が動作する
- [ ] `rollback()` が動作する
- [ ] `run()` が動作する
- [ ] 統合テスト5件以上

---

### TASK-V3-036: Dead Letter Queue 実装

**優先度**: P1
**見積もり**: 4h
**担当**: -
**要件ID**: REQ-003-027
**設計参照**: DES-003 §7.4

#### 説明
処理失敗メッセージを保存するDead Letter Queueを実装する。

#### 受入条件
- [ ] DeadLetterQueue クラスが実装されている
- [ ] 失敗アイテムの保存が動作する
- [ ] リトライカウント管理が動作する
- [ ] 手動リトライが動作する
- [ ] テスト5件以上

---

### TASK-V3-037: Neo4j差分更新対応

**優先度**: P1
**見積もり**: 4h
**担当**: -
**要件ID**: F-005
**設計参照**: DES-003 §3.2

#### 説明
@yagokoro/neo4j に差分更新機能を追加する。

#### 受入条件
- [ ] `applyDiff()` メソッドが追加されている
- [ ] トランザクションサポートが動作する
- [ ] ロールバックが動作する
- [ ] テスト5件以上

---

### TASK-V3-038: Sprint 4 統合テスト

**優先度**: P1
**見積もり**: 6h
**担当**: -
**要件ID**: F-005
**設計参照**: DES-003 §5

#### 説明
Phase 4 の統合テストを実施。差分更新パイプラインの動作を検証。

#### 受入条件
- [ ] E2Eテスト: 変更検知 → 差分計算 → 適用 が動作する
- [ ] E2Eテスト: ロールバックが動作する
- [ ] パフォーマンステスト: 10分以内の差分更新
- [ ] テスト合計15件以上

---

## 6. Sprint 5: Phase 5 - クエリキャッシュ

### TASK-V3-039: cache パッケージ初期化

**優先度**: P2
**見積もり**: 2h
**担当**: -
**要件ID**: F-006（基盤）
**設計参照**: DES-003 §2.3.5

#### 説明
`libs/cache` パッケージを新規作成し、基本構造を整備する。

#### 受入条件
- [ ] `libs/cache/package.json` が作成されている
- [ ] ディレクトリ構造（store/, invalidation/, stats/）が作成されている
- [ ] `pnpm build` が成功する

---

### TASK-V3-040: CacheStore 実装

**優先度**: P2
**見積もり**: 6h
**担当**: -
**要件ID**: REQ-003-019
**設計参照**: DES-003 §2.3.5, §3.3

#### 説明
キャッシュストアを実装する。LRU eviction、TTL管理、メモリ/ディスク対応。

#### 受入条件
- [ ] CacheStore クラスが実装されている
- [ ] LRU evictionが動作する
- [ ] TTL管理が動作する
- [ ] メモリストアが動作する
- [ ] オプションでディスク永続化が動作する
- [ ] テスト15件以上

---

### TASK-V3-041: InvalidationManager 実装

**優先度**: P2
**見積もり**: 4h
**担当**: -
**要件ID**: REQ-003-019
**設計参照**: DES-003 §2.3.5

#### 説明
キャッシュ無効化マネージャーを実装する。依存グラフベースの選択的無効化。

#### 受入条件
- [ ] InvalidationManager クラスが実装されている
- [ ] グラフ変更検知が動作する
- [ ] 依存グラフ管理が動作する
- [ ] 選択的無効化が動作する
- [ ] テスト10件以上

---

### TASK-V3-042: CacheStats 実装

**優先度**: P2
**見積もり**: 2h
**担当**: -
**要件ID**: REQ-003-019
**設計参照**: DES-003 §2.3.5

#### 説明
キャッシュ統計機能を実装する。

#### 受入条件
- [ ] CacheStats クラスが実装されている
- [ ] ヒット率計算が動作する
- [ ] メモリ使用量計測が動作する
- [ ] レイテンシ計測が動作する
- [ ] テスト5件以上

---

### TASK-V3-043: CacheService 実装

**優先度**: P2
**見積もり**: 4h
**担当**: -
**要件ID**: F-006
**設計参照**: DES-003 §4.2.5

#### 説明
キャッシュサービスを統合実装する。

#### 受入条件
- [ ] CacheService クラスが実装されている
- [ ] `get()`, `set()`, `delete()` が動作する
- [ ] `invalidate()` が動作する
- [ ] `getStats()` が動作する
- [ ] 統合テスト5件以上

---

### TASK-V3-044: NLQ/MCPキャッシュ統合

**優先度**: P2
**見積もり**: 4h
**担当**: -
**要件ID**: F-006
**設計参照**: DES-003 §5.3

#### 説明
NLQサービスとMCPツールにキャッシュを統合する。

#### 受入条件
- [ ] NLQサービスがキャッシュを使用している
- [ ] キャッシュヒット時は3秒以内のレスポンス
- [ ] キャッシュヒット率80%目標の計測が動作する
- [ ] テスト5件以上

---

## 7. Sprint 6: Phase 6 - 統合テスト・ドキュメント

### TASK-V3-045: E2E統合テスト

**優先度**: P0
**見積もり**: 8h
**担当**: -
**要件ID**: 全機能
**設計参照**: DES-003 §8

#### 説明
全機能を通した統合テストを実施する。

#### 受入条件
- [ ] 論文取り込み → 関係抽出 → HITL → グラフ反映 の全フローが動作する
- [ ] MCPクライアント経由で全15ツールが動作する
- [ ] 差分更新が動作する
- [ ] キャッシュが動作する
- [ ] テスト合計30件以上

---

### TASK-V3-046: パフォーマンステスト

**優先度**: P1
**見積もり**: 4h
**担当**: -
**要件ID**: NFR
**設計参照**: DES-003 §7.1

#### 説明
パフォーマンス要件を検証する。

#### 受入条件
- [ ] 論文取り込み: 100件/時間 を達成
- [ ] NLQレスポンス: 3秒以内 を達成
- [ ] 差分更新: 10分以内 を達成
- [ ] k6負荷テストが完了している

---

### TASK-V3-047: ドキュメント更新

**優先度**: P1
**見積もり**: 4h
**担当**: -
**要件ID**: -
**設計参照**: -

#### 説明
READMEとAPIドキュメントを更新する。

#### 受入条件
- [ ] README.md が更新されている
- [ ] MCPツールのAPIドキュメントが作成されている
- [ ] 新パッケージのREADMEが作成されている
- [ ] CHANGELOGが更新されている

---

### TASK-V3-048: v3.0.0リリース準備

**優先度**: P0
**見積もり**: 4h
**担当**: -
**要件ID**: -
**設計参照**: -

#### 説明
v3.0.0リリースの準備を行う。

#### 受入条件
- [ ] 全パッケージのバージョンが3.0.0に更新されている
- [ ] 全テストがパスしている
- [ ] リリースノートが作成されている
- [ ] Git tagが作成されている

---

### TASK-V3-049: CI/CD更新

**優先度**: P1
**見積もり**: 2h
**担当**: -
**要件ID**: -
**設計参照**: -

#### 説明
CI/CDパイプラインを更新して新パッケージをサポートする。

#### 受入条件
- [ ] GitHub Actionsワークフローが更新されている
- [ ] 新パッケージのビルド・テストが自動実行される
- [ ] カバレッジレポートが新パッケージを含む

---

### TASK-V3-050: バッファ・バグ修正

**優先度**: P1
**見積もり**: 8h
**担当**: -
**要件ID**: -
**設計参照**: -

#### 説明
リリース前の最終調整とバグ修正を行う。

#### 受入条件
- [ ] 発見されたバグが修正されている
- [ ] エッジケースが対応されている
- [ ] コードレビューが完了している

---

## 8. 進捗トラッキング

### 8.1 Sprint進捗

| Sprint | 開始予定 | 完了予定 | Status | 完了タスク |
|--------|---------|---------|--------|-----------|
| Sprint 1 | Week 1 | Week 2 | Not Started | 0/8 |
| Sprint 2 | Week 3 | Week 5 | Not Started | 0/10 |
| Sprint 3 | Week 6 | Week 7 | Not Started | 0/12 |
| Sprint 4 | Week 8 | Week 9 | Not Started | 0/8 |
| Sprint 5 | Week 10 | Week 11 | Not Started | 0/6 |
| Sprint 6 | Week 12 | Week 12 | Not Started | 0/6 |

### 8.2 テスト進捗

| パッケージ | 目標テスト数 | 現在 | 達成率 |
|-----------|-------------|------|--------|
| libs/ingestion | 80 | 0 | 0% |
| libs/extractor | 100 | 0 | 0% |
| libs/hitl | 60 | 0 | 0% |
| libs/pipeline | 80 | 0 | 0% |
| libs/cache | 50 | 0 | 0% |
| libs/mcp (拡張) | 100 | 0 | 0% |
| E2E | 30 | 0 | 0% |
| **合計** | **500** | **0** | **0%** |

---

## 9. リスク管理

| リスク | 影響 | 確率 | 対策 |
|--------|------|------|------|
| arXiv API仕様変更 | Phase 1遅延 | 低 | APIバージョン固定、変更監視 |
| LLM推論精度不足 | Phase 2品質低下 | 中 | プロンプトチューニング、複数モデル併用 |
| HITL対象件数過多 | レビュー滞留 | 中 | 閾値調整、バッチ承認機能強化 |
| Neo4j性能問題 | Phase 4遅延 | 低 | インデックス最適化、バッチサイズ調整 |
| 開発リソース不足 | 全体遅延 | 中 | P2機能の後回し、段階リリース |

---

## 10. 変更履歴

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0.0 | 2025-12-31 | GitHub Copilot | 初版作成 |

---

**Document Status**: Draft
**Total Tasks**: 50
**Total Estimated Hours**: 218h
**Target Completion**: 12 weeks

# YAGOKORO v5.0.0 要件定義書

**Version**: 5.0.0
**Status**: Draft
**Created**: 2025-12-31
**Updated**: 2025-12-31
**Author**: GitHub Copilot (MUSUBI SDD)

---

## 0. 憲法準拠チェック

| Article | 要件 | 状態 | 備考 |
|---------|------|------|------|
| I | Library-First | ✅ | @yagokoro/multilang, @yagokoro/citation, @yagokoro/topic 3パッケージ定義 |
| II | CLI Interface | ✅ | multilang/citation/topic 各コマンド詳細定義済 |
| III | Test-First | ✅ | 555+テスト目標、トレーサビリティマトリクス完備 |
| IV | EARS Format | ✅ | 全39要件がEARS 5パターン準拠（Unwanted behavior含む） |
| V | Traceability | ✅ | REQ→Test→EXPマッピング完了（Section 5.2） |
| VI | Project Memory | ⏳ | steering/*.md 更新予定 |
| VII | Simplicity Gate | ✅ | 3パッケージ追加（v4.0.0: 2パッケージ → 許容範囲内） |
| VIII | Anti-Abstraction | ✅ | BERTopic/DeepL/spaCy直接使用、独自フレームワークなし |
| IX | Integration Testing | ✅ | 実API使用方針明記（ADR-004/005）、フォールバック定義済 |

---

## 1. バージョン概要

### 1.1 v5.0.0のテーマ

**「多言語対応・引用ネットワーク・トピックモデリング」**

v4.0.0で構築した時系列分析・研究者ネットワーク基盤を活用し、グローバルなAI研究の分析と、より深い意味的分析機能を追加します。

### 1.2 v4.0.0からの継続

| v4.0.0 機能 | 状態 | v5.0.0での活用 |
|-------------|------|----------------|
| 時系列分析 | ✅ Complete | 多言語論文のトレンド分析に活用 |
| 研究者ネットワーク | ✅ Complete | 国際共著ネットワーク分析に活用 |
| TemporalService | ✅ Complete | 引用タイムライン分析に活用 |
| ResearcherService | ✅ Complete | 引用ネットワーク分析に活用 |
| MCP ツール29種 | ✅ Complete | 拡張ツールの基盤 |

### 1.3 今後の展望（v4.0.0レポートより）

| Feature ID | 機能名 | 優先度 | v5.0.0 対応 |
|------------|--------|--------|-------------|
| F-008 | 多言語論文対応 | P0 | ✅ 対象 |
| F-009 | 引用ネットワーク分析 | P0 | ✅ 対象 |
| F-010 | トピックモデリング統合 | P1 | ✅ 対象 |
| F-011 | リアルタイム論文監視 | P2 | ⏳ v6.0.0へ延期 |

---

## 2. フィーチャー定義

### 2.1 F-008: 多言語論文対応（Multilingual Support）

#### 2.1.1 概要

中国語（arXiv中国版、CNKI）、日本語（CiNii）、韓国語（KCI）などの非英語論文を取り込み、統一的な知識グラフに統合します。言語横断的な研究分析を実現します。

#### 2.1.2 ユースケース

| UC-ID | ユースケース | アクター |
|-------|--------------|----------|
| UC-008-1 | 中国語AI論文を検索・分析する | AI研究者 |
| UC-008-2 | 言語横断で同一技術のトレンドを比較する | PM/ビジネスリーダー |
| UC-008-3 | 多言語論文を自動翻訳してサマリーを取得する | 全ユーザー |
| UC-008-4 | 言語別の研究コミュニティを可視化する | AI研究者 |
| UC-008-5 | 国際共著パターンを分析する | AI研究者 |

#### 2.1.3 要件（EARS形式）

**機能要件**

| REQ-ID | 種別 | 要件 |
|--------|------|------|
| REQ-008-01 | Ubiquitous | The system SHALL support ingestion of papers in English, Chinese (Simplified/Traditional), Japanese, and Korean. |
| REQ-008-02 | Event-driven | WHEN a non-English paper is ingested, the system SHALL detect the source language and store it as metadata. |
| REQ-008-03 | Ubiquitous | The system SHALL provide automatic translation of titles, abstracts, and key terms to English. |
| REQ-008-04 | State-driven | WHILE querying, the system SHALL support language filtering (e.g., `--lang zh` for Chinese papers). |
| REQ-008-05 | Ubiquitous | The system SHALL normalize entity names across languages (e.g., "大規模言語モデル" = "Large Language Model"). |
| REQ-008-06 | Event-driven | WHEN extracting entities from non-English text, the system SHALL use language-specific NER models. |
| REQ-008-07 | Optional | WHERE multiple language versions of the same paper exist, the system MAY link them as variants. |
| REQ-008-08 | Unwanted | IF translation API fails, THEN the system SHALL return original text with error flag and log the failure. |
| REQ-008-09 | Unwanted | IF language detection confidence is below 0.7, THEN the system SHALL flag as "unknown" and request manual review. |

**非機能要件**

| REQ-ID | 種別 | 要件 |
|--------|------|------|
| REQ-008-10 | Performance | Translation SHALL complete within 2 seconds per abstract. |
| REQ-008-11 | Accuracy | Cross-lingual entity linking SHALL achieve >80% precision. |
| REQ-008-12 | Coverage | The system SHALL support at least 4 languages by v5.0.0. |

#### 2.1.4 CLIコマンド定義（Article II準拠）

```bash
# 多言語論文取り込み
yagokoro multilang ingest --source cnki --lang zh --from 2023-01-01
yagokoro multilang ingest --source cinii --lang ja --limit 100

# 言語横断検索
yagokoro multilang search "large language model" --langs en,zh,ja
yagokoro multilang search "トランスフォーマー" --translate

# 言語別統計
yagokoro multilang stats --by-language
yagokoro multilang stats --by-country

# 翻訳
yagokoro multilang translate <paperId> --to en
yagokoro multilang translate <paperId> --fields title,abstract
```

#### 2.1.5 技術設計方針

```
@yagokoro/multilang (新規パッケージ)
├── LanguageDetector       # 言語自動検出
├── TranslationService     # 翻訳サービス統合
├── CrossLingualLinker     # 言語横断エンティティリンキング
├── MultilingualIngester   # 多言語論文取り込み
└── TermNormalizer         # 多言語用語正規化
```

#### 2.1.6 翻訳API選定基準（ADR-004）

**決定**: DeepL API (Primary) + Google Translate (Fallback)

| 観点 | DeepL | Google Translate | 選定理由 |
|------|-------|------------------|----------|
| **精度** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | 学術文書でDeepL優位 |
| **日本語品質** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | DeepLの日本語自然 |
| **API料金** | $20/1M chars | $20/1M chars | 同等 |
| **無料枠** | 500K chars/月 | なし | DeepL有利 |
| **レート制限** | 制限緩め | 制限厳しめ | DeepL有利 |
| **中国語対応** | 簡体字・繁体字 | 簡体字・繁体字 | 同等 |

**フォールバック戦略**:
```typescript
class TranslationService {
  async translate(text: string, targetLang: LanguageCode): Promise<TranslationResult> {
    try {
      // 1. キャッシュチェック（Redis/SQLite）
      const cached = await this.cache.get(text, targetLang);
      if (cached) return cached;
      
      // 2. DeepL API呼び出し
      const result = await this.deepl.translate(text, targetLang);
      await this.cache.set(text, targetLang, result);
      return result;
    } catch (error) {
      // 3. DeepL失敗時 → Google Translateへフォールバック
      console.warn('DeepL failed, falling back to Google Translate');
      return await this.googleTranslate.translate(text, targetLang);
    }
  }
}
```

**コスト最適化**:
- アブストラクト翻訳結果をキャッシュ（TTL: 30日）
- バッチ処理で API呼び出し削減（100件/バッチ）
- 英語論文は翻訳スキップ

#### 2.1.7 データモデル拡張

```typescript
// 既存Paper拡張
interface MultilingualMetadata {
  sourceLanguage: LanguageCode;       // 'en' | 'zh' | 'ja' | 'ko'
  translatedTitle?: string;            // 英語翻訳タイトル
  translatedAbstract?: string;         // 英語翻訳アブストラクト
  originalTitle: string;               // 原語タイトル
  country?: string;                    // 論文の国/地域
  variants?: string[];                 // 他言語版のID
}

type LanguageCode = 'en' | 'zh' | 'zh-tw' | 'ja' | 'ko';

// 新規: CrossLingualEntity
interface CrossLingualEntity {
  canonicalId: string;                 // 正規化されたエンティティID
  names: Record<LanguageCode, string>; // 言語別名称
  primaryLanguage: LanguageCode;       // 最初に発見された言語
}
```

---

### 2.2 F-009: 引用ネットワーク分析（Citation Network Analysis）

#### 2.2.1 概要

論文間の引用関係を詳細に分析し、知識の伝播パターン、影響力の流れ、引用コンテキストを可視化します。

#### 2.2.2 ユースケース

| UC-ID | ユースケース | アクター |
|-------|--------------|----------|
| UC-009-1 | 特定論文の引用ツリーを表示する | AI研究者 |
| UC-009-2 | 論文間の引用パスを発見する | AI研究者 |
| UC-009-3 | 引用コンテキスト（どの文脈で引用されたか）を分析する | AI研究者 |
| UC-009-4 | 「sleeping beauty」論文（遅延引用論文）を検出する | PM/ビジネスリーダー |
| UC-009-5 | 引用バースト（急増）を検出する | 全ユーザー |
| UC-009-6 | 自己引用パターンを分析する | AI研究者 |

#### 2.2.3 要件（EARS形式）

**機能要件**

| REQ-ID | 種別 | 要件 |
|--------|------|------|
| REQ-009-01 | Ubiquitous | The system SHALL extract and store citation relationships with direction (cites/cited_by). |
| REQ-009-02 | Event-driven | WHEN a paper is ingested, the system SHALL extract in-text citation contexts. |
| REQ-009-03 | Ubiquitous | The system SHALL calculate citation-based metrics (citation count, citation velocity, h-index impact). |
| REQ-009-04 | State-driven | WHILE analyzing citations, the system SHALL classify citation intent (background, method, comparison, extension). |
| REQ-009-05 | Ubiquitous | The system SHALL support citation path queries between any two papers. |
| REQ-009-06 | Event-driven | WHEN citation velocity exceeds threshold, the system SHALL flag as "citation burst". |
| REQ-009-07 | Ubiquitous | The system SHALL detect self-citation patterns and cross-citation clusters. |
| REQ-009-08 | Optional | WHERE full-text is available, the system MAY extract exact citation sentences. |
| REQ-009-09 | Unwanted | IF citation graph is disconnected between two papers, THEN the system SHALL return "no path found" with nearest common ancestor suggestions. |
| REQ-009-10 | Unwanted | IF citation extraction fails for a paper, THEN the system SHALL log error and continue processing without system crash. |

**非機能要件**

| REQ-ID | 種別 | 要件 |
|--------|------|------|
| REQ-009-11 | Performance | Citation path queries SHALL complete within 1 second for paths up to 5 hops. |
| REQ-009-12 | Accuracy | Citation intent classification SHALL achieve >75% accuracy. |
| REQ-009-13 | Scale | The system SHALL handle >1M citation edges without degradation. |

#### 2.2.4 CLIコマンド定義（Article II準拠）

```bash
# 引用ツリー表示
yagokoro citation tree <paperId> --depth 3 --direction both
yagokoro citation tree <paperId> --direction cites --limit 50

# 引用パス検索
yagokoro citation path <paper1> <paper2> --max-hops 5
yagokoro citation path "Attention is All You Need" "GPT-4" --show-context

# 引用分析
yagokoro citation analyze <paperId> --metrics velocity,burst,impact
yagokoro citation burst --period 2024 --threshold 50

# 引用コンテキスト
yagokoro citation context <paperId> --intent method
yagokoro citation context <paperId> --top 10

# 自己引用分析
yagokoro citation self-cite <authorId> --include-coauthors
```

#### 2.2.5 技術設計方針

```
@yagokoro/citation (新規パッケージ)
├── CitationExtractor      # 引用関係抽出
├── CitationContextParser  # 引用コンテキスト解析
├── CitationIntentClassifier # 引用意図分類
├── CitationPathFinder     # 引用パス検索
├── CitationBurstDetector  # 引用バースト検出
├── SelfCitationAnalyzer   # 自己引用分析
└── CitationService        # 統合ファサード
```

#### 2.2.6 データモデル拡張

```typescript
// 新規: CitationEdge
interface CitationEdge {
  citingPaperId: string;
  citedPaperId: string;
  context?: CitationContext;
  intent: CitationIntent;
  section?: string;              // Introduction, Method, Results, etc.
  sentenceCount: number;         // この引用が何回文中に登場したか
  firstCitedAt?: Date;
}

type CitationIntent = 
  | 'background'      // 背景として引用
  | 'method'          // 手法として採用
  | 'comparison'      // 比較対象
  | 'extension'       // 拡張・改良の基礎
  | 'criticism'       // 批判・反論
  | 'unknown';

interface CitationContext {
  sentence: string;              // 引用文
  surroundingText?: string;      // 前後の文脈
  sentiment: 'positive' | 'neutral' | 'negative';
}

// 新規: CitationMetrics
interface CitationMetrics {
  paperId: string;
  totalCitations: number;
  citationVelocity: number;      // citations/month
  citationBursts: CitationBurst[];
  hIndexContribution: number;    // この論文のh-index寄与
  selfCitationRate: number;      // 自己引用率
}

interface CitationBurst {
  startDate: Date;
  endDate: Date;
  peakCitations: number;
  triggerEvent?: string;         // バーストのきっかけ（例: "ChatGPT release"）
}
```

---

### 2.3 F-010: トピックモデリング統合（Topic Modeling Integration）

#### 2.3.1 概要

LDA/BERTopicなどのトピックモデリング技術を統合し、論文コーパスから潜在的な研究トピックを自動抽出・分類します。

#### 2.3.2 ユースケース

| UC-ID | ユースケース | アクター |
|-------|--------------|----------|
| UC-010-1 | 論文コーパスから主要トピックを自動抽出する | AI研究者 |
| UC-010-2 | 特定論文が属するトピックを表示する | AI研究者 |
| UC-010-3 | トピックの時系列変化を可視化する | PM/ビジネスリーダー |
| UC-010-4 | 類似トピックの論文をクラスタリングする | 全ユーザー |
| UC-010-5 | 新興トピックを自動検出する | AI研究者 |
| UC-010-6 | トピック間の関係性を分析する | AI研究者 |

#### 2.3.3 要件（EARS形式）

**機能要件**

| REQ-ID | 種別 | 要件 |
|--------|------|------|
| REQ-010-01 | Ubiquitous | The system SHALL support topic extraction using BERTopic algorithm. |
| REQ-010-02 | Event-driven | WHEN new papers are ingested, the system SHALL assign topic labels to each paper. |
| REQ-010-03 | Ubiquitous | The system SHALL provide topic hierarchy (main topics → subtopics). |
| REQ-010-04 | State-driven | WHILE analyzing topics over time, the system SHALL detect emerging and declining topics. |
| REQ-010-05 | Ubiquitous | The system SHALL calculate topic similarity scores between papers. |
| REQ-010-06 | Event-driven | WHEN queried, the system SHALL return top-N papers for each topic. |
| REQ-010-07 | Ubiquitous | The system SHALL provide topic keywords and representative papers. |
| REQ-010-08 | Optional | WHERE user provides custom topics, the system MAY support guided topic modeling. |
| REQ-010-09 | Unwanted | IF topic extraction fails for a paper, THEN the system SHALL assign to "uncategorized" topic and log warning. |
| REQ-010-10 | Unwanted | IF BERTopic Python subprocess times out, THEN the system SHALL retry once and fallback to cached model. |

**非機能要件**

| REQ-ID | 種別 | 要件 |
|--------|------|------|
| REQ-010-11 | Performance | Topic assignment for a single paper SHALL complete within 500ms. |
| REQ-010-12 | Accuracy | Topic coherence score SHALL exceed 0.5 (NPMI). |
| REQ-010-13 | Scale | The system SHALL support >100 topics without quality degradation. |

#### 2.3.4 CLIコマンド定義（Article II準拠）

```bash
# トピック抽出
yagokoro topic extract --num-topics 50 --min-docs 10
yagokoro topic extract --algorithm bertopic --embedding-model all-MiniLM-L6-v2

# トピック表示
yagokoro topic list --top 20
yagokoro topic show <topicId> --papers 10 --keywords 15

# 論文のトピック割り当て
yagokoro topic assign <paperId>
yagokoro topic assign --batch --input papers.json

# トピック時系列
yagokoro topic trends --period 2020-2024 --top 10
yagokoro topic emerging --threshold 0.3

# トピック類似度
yagokoro topic similar <topicId> --top 5
yagokoro topic papers <topicId> --sort relevance --limit 20
```

#### 2.3.5 技術設計方針

```
@yagokoro/topic (新規パッケージ)
├── TopicExtractor         # BERTopic統合
├── TopicAssigner          # 論文へのトピック割り当て
├── TopicHierarchyBuilder  # トピック階層構築
├── TopicTrendAnalyzer     # トピック時系列分析
├── EmergingTopicDetector  # 新興トピック検出
└── TopicService           # 統合ファサード
```

#### 2.3.6 BERTopic統合方式（ADR-005）

**決定**: Python subprocess方式を採用

| 方式 | 利点 | 欠点 | 採用 |
|------|------|------|------|
| **Python subprocess** | BERTopic完全互換、最新機能利用可能 | プロセス間通信オーバーヘッド | ✅ |
| HTTP API (FastAPI) | 非同期処理可能、スケーラブル | 追加インフラ必要 | ❌ |
| WASM | ブラウザ対応 | BERTopic非対応、精度低下 | ❌ |
| ONNX Runtime (Node.js) | 高速推論 | モデル変換作業、機能制限 | ❌ |

**実装方針**:
```typescript
// TopicExtractor.ts
import { spawn } from 'child_process';

class TopicExtractor {
  private pythonPath: string;
  
  async extractTopics(documents: string[]): Promise<Topic[]> {
    // 1. JSON形式で入力データを一時ファイルに書き出し
    // 2. Python BERTopicスクリプトをsubprocessで実行
    // 3. stdout/stderrをストリーム処理
    // 4. 結果JSONをパースして返却
    // 5. タイムアウト: 30秒、リトライ: 1回
  }
}
```

#### 2.3.7 データモデル拡張

```typescript
// 新規: Topic
interface Topic {
  id: string;
  name: string;                    // 自動生成または手動ラベル
  keywords: string[];              // 上位キーワード
  representativePapers: string[];  // 代表論文ID
  parentTopicId?: string;          // 親トピック（階層構造）
  childTopicIds?: string[];        // 子トピック
  coherenceScore: number;          // トピック一貫性スコア
  paperCount: number;
  createdAt: Date;
  updatedAt: Date;
}

// 新規: PaperTopic（論文-トピック関連）
interface PaperTopic {
  paperId: string;
  topicId: string;
  probability: number;             // トピック所属確率
  rank: number;                    // この論文でのトピック順位
}

// 新規: TopicTrend
interface TopicTrend {
  topicId: string;
  period: { start: Date; end: Date };
  paperCount: number;
  growthRate: number;              // 成長率
  status: 'emerging' | 'growing' | 'stable' | 'declining';
}

// 新規: TopicRelation
interface TopicRelation {
  topicId1: string;
  topicId2: string;
  similarity: number;              // コサイン類似度
  relationType: 'parent' | 'sibling' | 'related';
}
```

---

## 3. MCP ツール拡張

### 3.1 新規ツール（F-008: 多言語対応）

| ツール名 | 説明 | パラメータ |
|----------|------|------------|
| `multilang_search` | 言語横断検索 | query, languages[], translate |
| `multilang_translate` | 論文翻訳 | paperId, targetLang, fields[] |
| `multilang_stats` | 言語別統計 | groupBy, period |
| `multilang_entities` | 言語横断エンティティ | entityName, languages[] |

### 3.2 新規ツール（F-009: 引用ネットワーク）

| ツール名 | 説明 | パラメータ |
|----------|------|------------|
| `citation_tree` | 引用ツリー取得 | paperId, depth, direction |
| `citation_path` | 引用パス検索 | paper1, paper2, maxHops |
| `citation_context` | 引用コンテキスト取得 | paperId, intent |
| `citation_burst` | 引用バースト検出 | period, threshold |
| `citation_analyze` | 引用メトリクス分析 | paperId, metrics[] |

### 3.3 新規ツール（F-010: トピックモデリング）

| ツール名 | 説明 | パラメータ |
|----------|------|------------|
| `topic_list` | トピック一覧 | limit, sortBy |
| `topic_show` | トピック詳細 | topicId, papers, keywords |
| `topic_assign` | トピック割り当て | paperId |
| `topic_trends` | トピック時系列 | period, topN |
| `topic_similar` | 類似トピック | topicId, limit |
| `topic_emerging` | 新興トピック検出 | threshold |

---

## 4. 成功指標（KPI）

### 4.1 F-008: 多言語対応

| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| 言語カバレッジ | 4言語以上 | en, zh, ja, ko サポート |
| 翻訳精度 | BLEU >30 | 機械翻訳評価 |
| 言語横断リンキング精度 | >80% | サンプル検証 |
| 翻訳レイテンシ | <2秒/abstract | 平均応答時間 |

### 4.2 F-009: 引用ネットワーク

| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| 引用抽出精度 | >95% | サンプル検証 |
| 引用意図分類精度 | >75% | 専門家ラベリングとの比較 |
| 引用パスクエリ応答時間 | <1秒 | 5ホップまで |
| 引用エッジスケール | >1M edges | 劣化なし |

### 4.3 F-010: トピックモデリング

| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| トピック一貫性 | NPMI >0.5 | Coherence score |
| トピック割り当て速度 | <500ms/paper | 平均処理時間 |
| 新興トピック検出精度 | >70% | 専門家評価 |
| トピック数 | 50-100 | 最適トピック数 |

---

## 5. テスト戦略

### 5.1 テストカテゴリ

| カテゴリ | 対象 | 目標件数 |
|----------|------|----------|
| Unit Tests | @yagokoro/multilang | 120+ |
| Unit Tests | @yagokoro/citation | 150+ |
| Unit Tests | @yagokoro/topic | 100+ |
| Integration Tests | 翻訳API統合 | 30+ |
| Integration Tests | 引用グラフクエリ | 50+ |
| E2E Tests | MCP新規15ツール | 45+ |
| CLI Tests | multilang/citation/topic コマンド | 60+ |

### 5.2 トレーサビリティマトリクス（Article V準拠）

#### F-008: 多言語対応

| REQ-ID | テストファイル | テストケース | 実験 |
|--------|---------------|--------------|------|
| REQ-008-01 | multilang.ingester.test.ts | `should ingest Chinese paper` | EXP-031 |
| REQ-008-02 | multilang.detector.test.ts | `should detect source language` | EXP-031 |
| REQ-008-03 | multilang.translator.test.ts | `should translate abstract to English` | EXP-032 |
| REQ-008-04 | multilang.query.test.ts | `should filter by language` | EXP-031 |
| REQ-008-05 | multilang.linker.test.ts | `should normalize cross-lingual entities` | EXP-033 |
| REQ-008-06 | multilang.ner.test.ts | `should use language-specific NER` | EXP-033 |
| REQ-008-08 | multilang.error.test.ts | `should handle translation API failure` | EXP-032 |
| REQ-008-09 | multilang.detector.test.ts | `should flag low confidence language` | EXP-031 |
| REQ-008-10 | multilang.perf.test.ts | `should translate within 2s` | EXP-032 |
| REQ-008-11 | multilang.accuracy.test.ts | `should achieve >80% linking precision` | EXP-033 |

#### F-009: 引用ネットワーク

| REQ-ID | テストファイル | テストケース | 実験 |
|--------|---------------|--------------|------|
| REQ-009-01 | citation.extractor.test.ts | `should extract citation edges` | EXP-034 |
| REQ-009-02 | citation.context.test.ts | `should extract in-text contexts` | EXP-035 |
| REQ-009-03 | citation.metrics.test.ts | `should calculate citation metrics` | EXP-034 |
| REQ-009-04 | citation.intent.test.ts | `should classify citation intent` | EXP-035 |
| REQ-009-05 | citation.path.test.ts | `should find citation path` | EXP-036 |
| REQ-009-06 | citation.burst.test.ts | `should detect citation burst` | EXP-037 |
| REQ-009-09 | citation.path.test.ts | `should handle disconnected graph` | EXP-036 |
| REQ-009-10 | citation.error.test.ts | `should handle extraction failure gracefully` | EXP-034 |
| REQ-009-11 | citation.perf.test.ts | `should complete path query within 1s` | EXP-036 |
| REQ-009-12 | citation.accuracy.test.ts | `should achieve >75% intent accuracy` | EXP-035 |

#### F-010: トピックモデリング

| REQ-ID | テストファイル | テストケース | 実験 |
|--------|---------------|--------------|------|
| REQ-010-01 | topic.extractor.test.ts | `should extract topics with BERTopic` | EXP-038 |
| REQ-010-02 | topic.assigner.test.ts | `should assign topics to papers` | EXP-038 |
| REQ-010-03 | topic.hierarchy.test.ts | `should build topic hierarchy` | EXP-039 |
| REQ-010-04 | topic.trend.test.ts | `should detect emerging topics` | EXP-040 |
| REQ-010-05 | topic.similarity.test.ts | `should calculate topic similarity` | EXP-039 |
| REQ-010-09 | topic.error.test.ts | `should assign uncategorized on failure` | EXP-038 |
| REQ-010-10 | topic.subprocess.test.ts | `should handle BERTopic timeout` | EXP-038 |
| REQ-010-11 | topic.perf.test.ts | `should assign within 500ms` | EXP-038 |
| REQ-010-12 | topic.coherence.test.ts | `should achieve NPMI >0.5` | EXP-038 |

### 5.3 実験計画

| EXP-ID | 実験名 | 目的 | 検証要件 |
|--------|--------|------|----------|
| EXP-031 | MultilingualIngester | 多言語論文取り込み検証 | REQ-008-01, 02, 04 |
| EXP-032 | TranslationService | 翻訳精度・性能検証 | REQ-008-03, N01 |
| EXP-033 | CrossLingualLinker | 言語横断リンキング検証 | REQ-008-05, 06, N02 |
| EXP-034 | CitationExtractor | 引用抽出検証 | REQ-009-01, 03 |
| EXP-035 | CitationIntentClassifier | 引用意図分類検証 | REQ-009-02, 04, N02 |
| EXP-036 | CitationPathFinder | 引用パス検索検証 | REQ-009-05, N01 |
| EXP-037 | CitationBurstDetector | 引用バースト検出検証 | REQ-009-06 |
| EXP-038 | TopicExtractor | トピック抽出検証 | REQ-010-01, 02, N01, N02 |
| EXP-039 | TopicHierarchy | トピック階層・類似度検証 | REQ-010-03, 05 |
| EXP-040 | EmergingTopicDetector | 新興トピック検出検証 | REQ-010-04 |

---

## 6. 依存関係

### 6.1 v4.0.0からの依存

- `@yagokoro/temporal`: 時系列トピック分析に活用
- `@yagokoro/researcher`: 引用ネットワークとの統合
- `@yagokoro/ingestion`: 多言語論文取り込み基盤
- `@yagokoro/extractor`: 引用コンテキスト抽出
- `@yagokoro/mcp`: MCPツール基盤

### 6.2 新規外部依存

| 依存 | 用途 | ライセンス |
|------|------|------------|
| **BERTopic** | トピックモデリング | MIT |
| **sentence-transformers** | 埋め込み生成 | Apache 2.0 |
| **DeepL API / Google Translate** | 翻訳サービス | Commercial / Free tier |
| **langdetect** | 言語検出 | Apache 2.0 |
| **spaCy (multi-lingual)** | 多言語NER | MIT |
| **networkx** (Python) / **graphology** | 引用グラフ分析 | BSD / MIT |

---

## 7. リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| 翻訳API費用増大 | 高 | 中 | キャッシュ活用、バッチ処理、オープンソースモデル検討 |
| 多言語NER精度不足 | 中 | 中 | 言語別モデルの選定、HITL補正 |
| BERTopic依存（Python） | 中 | 低 | TypeScriptラッパー作成、サブプロセス呼び出し |
| 引用グラフ規模（1M+ edges） | 高 | 中 | Neo4j インデックス最適化、グラフ分割 |
| トピック数の爆発 | 低 | 低 | 階層的トピック、マージ機能 |

---

## 8. スプリント計画（案）

| Sprint | 期間 | フォーカス | 成果物 |
|--------|------|------------|--------|
| Sprint 1 | Week 1-2 | 多言語基盤 | LanguageDetector, TranslationService |
| Sprint 2 | Week 3-4 | @yagokoro/multilang | CrossLingualLinker, MultilingualIngester |
| Sprint 3 | Week 5-6 | 引用抽出 | CitationExtractor, CitationContextParser |
| Sprint 4 | Week 7-8 | @yagokoro/citation | CitationPathFinder, CitationBurstDetector |
| Sprint 5 | Week 9-10 | トピック基盤 | BERTopic統合, TopicExtractor |
| Sprint 6 | Week 11-12 | @yagokoro/topic | TopicTrendAnalyzer, EmergingTopicDetector |
| Sprint 7 | Week 13-14 | MCP/CLI統合 | 新規15ツール、CLIコマンド |
| Sprint 8 | Week 15-16 | 統合テスト | 実験 EXP-031〜040、ドキュメント |

---

## 9. 承認

| 役割 | 名前 | 承認日 |
|------|------|--------|
| Product Owner | - | - |
| Tech Lead | - | - |
| QA Lead | - | - |

---

## 付録

### A. 参考資料

- [v4.0.0 実験レポート](../../outputs/yagokoro-v4-report.md)
- [Constitutional Governance](../../steering/rules/constitution.md)
- [Technology Stack](../../steering/tech.ja.md)

### B. 用語集

| 用語 | 定義 |
|------|------|
| BERTopic | BERTベースのトピックモデリングアルゴリズム |
| NPMI | Normalized Pointwise Mutual Information（トピック一貫性指標） |
| Citation Burst | 引用数の急増現象 |
| Cross-lingual Entity Linking | 言語横断エンティティリンキング |
| Sleeping Beauty | 長期間引用されなかった後に急に注目される論文 |

### C. v4.0.0 → v5.0.0 機能比較

| 機能 | v4.0.0 | v5.0.0 |
|------|--------|--------|
| 対応言語 | 英語のみ | 英語, 中国語, 日本語, 韓国語 |
| 引用分析 | 単純カウント | コンテキスト・意図・パス分析 |
| トピック | 手動タグ | 自動トピックモデリング |
| MCPツール | 29 | 44（+15） |
| CLIコマンド | 13グループ | 16グループ（+3） |

---

*Generated by MUSUBI SDD - v5.0.0 Requirements Phase*

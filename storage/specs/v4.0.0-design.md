# YAGOKORO v4.0.0 è¨­è¨ˆæ›¸

**Version**: 4.0.0
**Status**: Draft
**Created**: 2025-12-31
**Author**: GitHub Copilot (MUSUBI SDD)

---

## 0. æ†²æ³•æº–æ‹ ãƒã‚§ãƒƒã‚¯

| Article | è¦ä»¶ | çŠ¶æ…‹ | å‚™è€ƒ |
|---------|------|------|------|
| I | Library-First | âœ… | @yagokoro/temporal, @yagokoro/researcher ã‚’ç‹¬ç«‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦è¨­è¨ˆ |
| II | CLI Interface | âœ… | Section 1.5 ã«CLIã‚³ãƒãƒ³ãƒ‰è©³ç´°ã‚’è¿½åŠ  |
| VI | Project Memory | âœ… | steering/*.md ã‚’å‚ç…§ã—ã¦è¨­è¨ˆ |
| VII | Simplicity Gate | âœ… | 2ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¿½åŠ ï¼ˆæ—¢å­˜ã¨åˆã‚ã›ã¦7ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€è¨±å®¹ç¯„å›²ï¼‰ |
| VIII | Anti-Abstraction | âœ… | Neo4j/graphology ã‚’ç›´æ¥ä½¿ç”¨ |

---

## 1. C4 Model ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 1.1 C4 Level 1: System Context Diagram

```mermaid
C4Context
    title YAGOKORO v4.0.0 - System Context

    Person(researcher, "AIç ”ç©¶è€…", "è«–æ–‡ãƒ»ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ»ç ”ç©¶è€…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’åˆ†æ")
    Person(pm, "PM/ãƒ“ã‚¸ãƒã‚¹ãƒªãƒ¼ãƒ€ãƒ¼", "ç ”ç©¶å‹•å‘ãƒ»æŠ•è³‡åˆ¤æ–­")
    
    System(yagokoro, "YAGOKORO", "è«–æ–‡çŸ¥è­˜ã‚°ãƒ©ãƒ•RAGã‚·ã‚¹ãƒ†ãƒ <br/>æ™‚ç³»åˆ—åˆ†æ + ç ”ç©¶è€…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯")
    
    System_Ext(arxiv, "arXiv API", "è«–æ–‡ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ»å…¨æ–‡")
    System_Ext(semantic, "Semantic Scholar", "è«–æ–‡ãƒ»å¼•ç”¨ãƒ‡ãƒ¼ã‚¿")
    System_Ext(orcid, "ORCID API", "ç ”ç©¶è€…è­˜åˆ¥æƒ…å ±")
    System_Ext(llm, "LLM Provider", "OpenAI / Anthropic")
    
    Rel(researcher, yagokoro, "ã‚¯ã‚¨ãƒªãƒ»åˆ†æ", "MCP/CLI")
    Rel(pm, yagokoro, "ãƒ¬ãƒãƒ¼ãƒˆé–²è¦§", "MCP/CLI")
    
    Rel(yagokoro, arxiv, "è«–æ–‡å–å¾—", "OAI-PMH")
    Rel(yagokoro, semantic, "å¼•ç”¨ãƒ‡ãƒ¼ã‚¿å–å¾—", "REST API")
    Rel(yagokoro, orcid, "ç ”ç©¶è€…ãƒ‡ãƒ¼ã‚¿å–å¾—", "REST API")
    Rel(yagokoro, llm, "æ¨è«–ãƒ»æŠ½å‡º", "API")
```

**å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ **:

| ã‚·ã‚¹ãƒ†ãƒ  | ç”¨é€” | ãƒ—ãƒ­ãƒˆã‚³ãƒ« | Rate Limit |
|----------|------|------------|------------|
| arXiv API | è«–æ–‡ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãƒ»å…¨æ–‡ | OAI-PMH | 3ç§’é–“éš” |
| Semantic Scholar | å¼•ç”¨ãƒ‡ãƒ¼ã‚¿ãƒ»è‘—è€…æƒ…å ± | REST | 100/5åˆ† |
| ORCID API | ç ”ç©¶è€…è­˜åˆ¥ | REST | 24/ç§’ |
| OpenAI/Anthropic | LLMæ¨è«– | REST | ãƒˆãƒ¼ã‚¯ãƒ³åˆ¶é™ |

---

### 1.2 C4 Level 2: Container Diagram

```mermaid
C4Container
    title YAGOKORO v4.0.0 - Container Diagram

    Person(user, "ãƒ¦ãƒ¼ã‚¶ãƒ¼", "AIç ”ç©¶è€…/PM")
    
    Container_Boundary(yagokoro, "YAGOKORO System") {
        Container(cli, "CLI App", "TypeScript", "yagokoroã‚³ãƒãƒ³ãƒ‰")
        Container(mcp, "MCP Server", "TypeScript", "Claude/GPTé€£æº")
        
        Container(temporal, "@yagokoro/temporal", "TypeScript", "æ™‚ç³»åˆ—åˆ†æãƒ©ã‚¤ãƒ–ãƒ©ãƒª<br/>[NEW v4]")
        Container(researcher, "@yagokoro/researcher", "TypeScript", "ç ”ç©¶è€…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯<br/>[NEW v4]")
        
        Container(graphrag, "@yagokoro/graphrag", "TypeScript", "GraphRAGã‚³ã‚¢")
        Container(extractor, "@yagokoro/extractor", "TypeScript", "é–¢ä¿‚æŠ½å‡º")
        Container(ingestion, "@yagokoro/ingestion", "TypeScript", "è«–æ–‡å–ã‚Šè¾¼ã¿")
        Container(domain, "@yagokoro/domain", "TypeScript", "ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«")
        
        ContainerDb(neo4j, "Neo4j", "Graph DB", "çŸ¥è­˜ã‚°ãƒ©ãƒ•")
        ContainerDb(qdrant, "Qdrant", "Vector DB", "ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢")
        ContainerDb(redis, "Redis", "Cache", "ã‚¯ã‚¨ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥")
    }
    
    System_Ext(arxiv, "arXiv API", "")
    System_Ext(orcid, "ORCID API", "")
    
    Rel(user, cli, "CLIæ“ä½œ")
    Rel(user, mcp, "AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆçµŒç”±")
    
    Rel(cli, temporal, "æ™‚ç³»åˆ—ã‚¯ã‚¨ãƒª")
    Rel(cli, researcher, "ç ”ç©¶è€…ã‚¯ã‚¨ãƒª")
    Rel(mcp, temporal, "MCPãƒ„ãƒ¼ãƒ«")
    Rel(mcp, researcher, "MCPãƒ„ãƒ¼ãƒ«")
    
    Rel(temporal, neo4j, "æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿")
    Rel(researcher, neo4j, "ç ”ç©¶è€…ã‚°ãƒ©ãƒ•")
    Rel(temporal, redis, "ã‚­ãƒ£ãƒƒã‚·ãƒ¥")
    
    Rel(ingestion, arxiv, "è«–æ–‡å–å¾—")
    Rel(researcher, orcid, "ç ”ç©¶è€…ãƒ‡ãƒ¼ã‚¿")
```

---

### 1.3 C4 Level 3: Component Diagram - @yagokoro/temporal

```mermaid
C4Component
    title @yagokoro/temporal - Component Diagram

    Container_Boundary(temporal, "@yagokoro/temporal") {
        Component(indexer, "TemporalIndexer", "Class", "æ™‚é–“å±æ€§ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ§‹ç¯‰<br/>REQ-004-01, REQ-004-02")
        Component(analyzer, "TrendAnalyzer", "Class", "ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ<br/>momentum, velocityè¨ˆç®—<br/>REQ-004-04")
        Component(timeline, "TimelineGenerator", "Class", "ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³å¯è¦–åŒ–ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ<br/>REQ-004-06")
        Component(hot, "HotTopicDetector", "Class", "Hot Topicsæ¤œå‡º<br/>REQ-004-07")
        Component(forecast, "TrendForecaster", "Class", "ãƒˆãƒ¬ãƒ³ãƒ‰äºˆæ¸¬ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰<br/>REQ-004-05")
        Component(service, "TemporalService", "Class", "ãƒ•ã‚¡ã‚µãƒ¼ãƒ‰<br/>CLIã¨MCPã‹ã‚‰ã®çµ±ä¸€ã‚¢ã‚¯ã‚»ã‚¹")
    }
    
    ContainerDb(neo4j, "Neo4j", "")
    ContainerDb(redis, "Redis", "")
    
    Rel(service, indexer, "ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ§‹ç¯‰")
    Rel(service, analyzer, "ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ")
    Rel(service, timeline, "ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç”Ÿæˆ")
    Rel(service, hot, "Hot Topics")
    Rel(service, forecast, "äºˆæ¸¬")
    
    Rel(indexer, neo4j, "æ™‚é–“å±æ€§ä¿å­˜")
    Rel(analyzer, neo4j, "æ™‚ç³»åˆ—ã‚¯ã‚¨ãƒª")
    Rel(timeline, redis, "ã‚­ãƒ£ãƒƒã‚·ãƒ¥")
```

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°**:

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | è²¬å‹™ | ä¾å­˜ | å¯¾å¿œè¦ä»¶ |
|----------------|------|------|----------|
| TemporalIndexer | ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã¸ã®æ™‚é–“å±æ€§ä»˜ä¸ | Neo4jRepository | REQ-004-01, REQ-004-02 |
| TrendAnalyzer | momentum/velocityè¨ˆç®—ã€æ¡ç”¨ãƒ•ã‚§ãƒ¼ã‚ºåˆ¤å®š | Neo4jRepository | REQ-004-04, REQ-004-N02 |
| TimelineGenerator | JSONå½¢å¼ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ | TrendAnalyzer, Redis | REQ-004-06, REQ-004-N01 |
| HotTopicDetector | æœŸé–“å†…ã®Hot TopicsæŠ½å‡º | TrendAnalyzer | REQ-004-07 |
| TrendForecaster | æ™‚ç³»åˆ—äºˆæ¸¬ï¼ˆARIMA/Prophetï¼‰ | TrendAnalyzer | REQ-004-05 |
| TemporalService | CLI/MCPã‹ã‚‰ã®çµ±ä¸€ã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆ | All components | - |

---

### 1.4 C4 Level 3: Component Diagram - @yagokoro/researcher

```mermaid
C4Component
    title @yagokoro/researcher - Component Diagram

    Container_Boundary(researcher, "@yagokoro/researcher") {
        Component(coauthor, "CoauthorExtractor", "Class", "å…±è‘—é–¢ä¿‚ã®æŠ½å‡º<br/>REQ-005-01, REQ-005-05")
        Component(affiliation, "AffiliationTracker", "Class", "æ‰€å±å±¥æ­´ã®è¿½è·¡<br/>REQ-005-02")
        Component(influence, "InfluenceCalculator", "Class", "å½±éŸ¿åŠ›ã‚¹ã‚³ã‚¢è¨ˆç®—<br/>h-index, PageRank<br/>REQ-005-03")
        Component(community, "CommunityDetector", "Class", "ç ”ç©¶ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ¤œå‡º<br/>Leiden Algorithm<br/>REQ-005-04")
        Component(career, "CareerAnalyzer", "Class", "ã‚­ãƒ£ãƒªã‚¢æ¨ç§»åˆ†æ<br/>REQ-005-02")
        Component(orcid, "ORCIDIntegration", "Class", "ORCIDé€£æº<br/>REQ-005-07")
        Component(service, "ResearcherService", "Class", "ãƒ•ã‚¡ã‚µãƒ¼ãƒ‰<br/>CLIã¨MCPã‹ã‚‰ã®çµ±ä¸€ã‚¢ã‚¯ã‚»ã‚¹")
    }
    
    ContainerDb(neo4j, "Neo4j", "")
    System_Ext(orcid_api, "ORCID API", "")
    
    Rel(service, coauthor, "å…±è‘—ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯")
    Rel(service, influence, "å½±éŸ¿åŠ›è¨ˆç®—")
    Rel(service, community, "ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ¤œå‡º")
    Rel(service, career, "ã‚­ãƒ£ãƒªã‚¢åˆ†æ")
    
    Rel(coauthor, neo4j, "å…±è‘—é–¢ä¿‚")
    Rel(influence, neo4j, "å¼•ç”¨ãƒ‡ãƒ¼ã‚¿")
    Rel(community, neo4j, "ã‚°ãƒ©ãƒ•åˆ†æ")
    Rel(orcid, orcid_api, "ç ”ç©¶è€…ãƒ‡ãƒ¼ã‚¿")
    Rel(affiliation, orcid, "æ‰€å±æƒ…å ±")
```

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè©³ç´°**:

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | è²¬å‹™ | ä¾å­˜ | å¯¾å¿œè¦ä»¶ |
|----------------|------|------|----------|
| CoauthorExtractor | è«–æ–‡ã‹ã‚‰å…±è‘—é–¢ä¿‚ã‚’æŠ½å‡ºã€ã‚¨ãƒƒã‚¸é‡ã¿è¨ˆç®— | Neo4jRepository | REQ-005-01, REQ-005-05 |
| AffiliationTracker | ç ”ç©¶è€…ã®æ‰€å±å±¥æ­´ã‚’æ™‚ç³»åˆ—ã§è¿½è·¡ | ORCIDIntegration | REQ-005-02 |
| InfluenceCalculator | h-index, å¼•ç”¨æ•°, PageRankã‚¹ã‚³ã‚¢è¨ˆç®— | Neo4jRepository | REQ-005-03, REQ-005-08 |
| CommunityDetector | Leiden/Louvainã«ã‚ˆã‚‹ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ¤œå‡º | graphology | REQ-005-04, REQ-005-N01 |
| CareerAnalyzer | ç ”ç©¶è€…ã®ã‚­ãƒ£ãƒªã‚¢ãƒ‘ã‚¹ã‚’å¯è¦–åŒ– | AffiliationTracker | REQ-005-02 |
| ORCIDIntegration | ORCID APIã¨ã®é€£æºã€åå¯„ã›è£œåŠ© | ORCID API | REQ-005-07 |
| ResearcherService | CLI/MCPã‹ã‚‰ã®çµ±ä¸€ã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆ | All components | REQ-005-06 |

**ORCID API ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥**:

```mermaid
flowchart TD
    A[ORCID APIå‘¼ã³å‡ºã—] --> B{æˆåŠŸ?}
    B -->|Yes| C[ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¿”å´]
    B -->|No| D{ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥}
    D -->|Rate Limit 429| E[æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•\næœ€å¤§3å›ãƒªãƒˆãƒ©ã‚¤]
    D -->|Timeout| F[CircuitBreakerçµŒç”±\n3å›å¤±æ•—ã§ã‚ªãƒ¼ãƒ—ãƒ³]
    D -->|Not Found 404| G[ãƒ­ãƒ¼ã‚«ãƒ«DBãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯]
    D -->|Server Error 5xx| H[ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¿”å´\nstale-while-revalidate]
    
    E --> I{ãƒªãƒˆãƒ©ã‚¤æˆåŠŸ?}
    I -->|Yes| C
    I -->|No| G
    F --> G
    H --> J[è­¦å‘Šãƒ­ã‚° + éƒ¨åˆ†ãƒ‡ãƒ¼ã‚¿è¿”å´]
    G --> K[åå‰ãƒ™ãƒ¼ã‚¹æ¤œç´¢ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯]
```

| ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | æˆ¦ç•¥ | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ |
|-------------|------|------------|---------------|
| 429 | æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼ˆ1s, 2s, 4sï¼‰ | æœ€å¤§3å› | ãƒ­ãƒ¼ã‚«ãƒ«DBæ¤œç´¢ |
| 408/Timeout | CircuitBreaker | 10ç§’ | ãƒ­ãƒ¼ã‚«ãƒ«DBæ¤œç´¢ |
| 404 | å³åº§ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ | - | åå‰ãƒ™ãƒ¼ã‚¹æ¤œç´¢ |
| 5xx | stale-while-revalidate | 1æ™‚é–“ | ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¿”å´ |

---

### 1.5 C4 Level 4: CLI Interface Design (Article II)

**v4.0.0 æ–°è¦CLIã‚³ãƒãƒ³ãƒ‰**:

```bash
# F-004: æ™‚ç³»åˆ—åˆ†æã‚³ãƒãƒ³ãƒ‰
yagokoro temporal index [--source arxiv|semantic] [--from DATE] [--to DATE]
yagokoro temporal trends [--period YEAR|QUARTER] [--top N] [--format json|table]
yagokoro temporal timeline <entity> [--from DATE] [--to DATE] [--output FILE]
yagokoro temporal hot-topics [--period YEAR] [--threshold FLOAT]
yagokoro temporal forecast <entity> [--horizon MONTHS]

# F-005: ç ”ç©¶è€…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚³ãƒãƒ³ãƒ‰
yagokoro researcher profile <name|orcid> [--format json|table]
yagokoro researcher coauthors <name|orcid> [--depth N] [--min-papers N]
yagokoro researcher influence <name|orcid> [--metrics hindex,pagerank,citations]
yagokoro researcher community <name|orcid> [--resolution FLOAT]
yagokoro researcher path <from> <to> [--max-hops N]
yagokoro researcher rank [--field FIELD] [--top N] [--metric METRIC]
```

**CLIã‚³ãƒãƒ³ãƒ‰ â†” ã‚µãƒ¼ãƒ“ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°**:

| ã‚³ãƒãƒ³ãƒ‰ | ã‚µãƒ¼ãƒ“ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ | å¯¾å¿œè¦ä»¶ |
|----------|-----------------|----------|
| `temporal index` | `TemporalService.index()` | REQ-004-01, REQ-004-02 |
| `temporal trends` | `TemporalService.detectTrends()` | REQ-004-04 |
| `temporal timeline` | `TemporalService.generateTimeline()` | REQ-004-06 |
| `temporal hot-topics` | `TemporalService.detectHotTopics()` | REQ-004-07 |
| `temporal forecast` | `TemporalService.forecast()` | REQ-004-05 |
| `researcher profile` | `ResearcherService.getProfile()` | REQ-005-07 |
| `researcher coauthors` | `ResearcherService.getCoauthors()` | REQ-005-01, REQ-005-05 |
| `researcher influence` | `ResearcherService.calculateInfluence()` | REQ-005-03 |
| `researcher community` | `ResearcherService.detectCommunity()` | REQ-005-04 |
| `researcher path` | `ResearcherService.findPath()` | REQ-005-06 |
| `researcher rank` | `ResearcherService.rank()` | REQ-005-08 |

**MCPãƒ„ãƒ¼ãƒ«ï¼ˆ12ãƒ„ãƒ¼ãƒ«è¿½åŠ ï¼‰**:

| ãƒ„ãƒ¼ãƒ«å | ã‚«ãƒ†ã‚´ãƒª | èª¬æ˜ |
|----------|----------|------|
| `analyzeTemporalTrends` | temporal | æœŸé–“å†…ã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ |
| `getEntityTimeline` | temporal | ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿å–å¾— |
| `detectHotTopics` | temporal | Hot Topicsæ¤œå‡º |
| `forecastTrend` | temporal | ãƒˆãƒ¬ãƒ³ãƒ‰äºˆæ¸¬ |
| `queryByTimeRange` | temporal | æ™‚é–“ç¯„å›²ã§ã‚¯ã‚¨ãƒª |
| `getResearcherProfile` | researcher | ç ”ç©¶è€…ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«å–å¾— |
| `getCoauthorNetwork` | researcher | å…±è‘—ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å–å¾— |
| `calculateInfluence` | researcher | å½±éŸ¿åŠ›ã‚¹ã‚³ã‚¢è¨ˆç®— |
| `detectCommunities` | researcher | ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ¤œå‡º |
| `findResearcherPath` | researcher | ç ”ç©¶è€…é–“ãƒ‘ã‚¹æ¤œç´¢ |
| `rankResearchers` | researcher | ç ”ç©¶è€…ãƒ©ãƒ³ã‚­ãƒ³ã‚° |
| `enrichWithORCID` | researcher | ORCIDæƒ…å ±ã§è£œå®Œ |

---

## 2. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«æ‹¡å¼µ

### 2.1 Neo4j ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ

```cypher
// ============================================
// v4.0.0 Schema Extensions
// ============================================

// --- F-004: Temporal Metadata ---

// æ—¢å­˜ãƒãƒ¼ãƒ‰ã¸ã®æ™‚é–“å±æ€§è¿½åŠ 
// AIModel, Technique, Benchmark, Publication ã«é©ç”¨
CREATE CONSTRAINT temporal_metadata IF NOT EXISTS
FOR (n:Entity) REQUIRE n.publicationDate IS NOT NULL;

// TrendMetrics ãƒãƒ¼ãƒ‰ï¼ˆæ—¥æ¬¡ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆï¼‰
CREATE (tm:TrendMetrics {
  entityId: string,
  date: date,
  citationCount: integer,
  citationVelocity: float,
  momentum: float,
  adoptionPhase: string  // 'emerging' | 'growing' | 'mature' | 'declining'
});

CREATE INDEX trend_entity_date IF NOT EXISTS
FOR (tm:TrendMetrics) ON (tm.entityId, tm.date);

// --- F-005: Researcher Network ---

// Person ãƒãƒ¼ãƒ‰æ‹¡å¼µ
// æ—¢å­˜ã® Person ã«ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ 
// - orcid: string (optional)
// - hIndex: integer
// - citationCount: integer
// - influenceScore: float

// Affiliation ãƒãƒ¼ãƒ‰ï¼ˆæ‰€å±å±¥æ­´ï¼‰
CREATE (a:Affiliation {
  personId: string,
  organization: string,
  startDate: date,
  endDate: date,       // null = ç¾åœ¨ã‚‚æ‰€å±
  role: string         // 'Researcher' | 'Professor' | 'PhD Student' | 'PostDoc' | 'Engineer'
});

CREATE INDEX affiliation_person IF NOT EXISTS
FOR (a:Affiliation) ON (a.personId);

// COAUTHORED é–¢ä¿‚ï¼ˆé‡ã¿ä»˜ãï¼‰
CREATE (p1:Person)-[c:COAUTHORED {
  paperCount: integer,
  firstCollaboration: date,
  lastCollaboration: date,
  weight: float        // frequency * recency factor
}]->(p2:Person);

CREATE INDEX coauthor_weight IF NOT EXISTS
FOR ()-[c:COAUTHORED]-() ON (c.weight);

// Community ãƒãƒ¼ãƒ‰ï¼ˆç ”ç©¶è€…ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ï¼‰
CREATE (rc:ResearcherCommunity {
  id: string,
  name: string,
  field: string,
  memberCount: integer,
  avgInfluence: float,
  detectedAt: datetime
});

// MEMBER_OF é–¢ä¿‚
CREATE (p:Person)-[:MEMBER_OF {
  since: date,
  role: string  // 'core' | 'peripheral'
}]->(rc:ResearcherCommunity);
```

### 2.2 TypeScript ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

```typescript
// libs/domain/src/entities/temporal.ts

/**
 * æ™‚é–“å±æ€§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
 * REQ-004-01: The system SHALL store temporal metadata for all entities
 */
export interface TemporalMetadata {
  publicationDate?: Date;
  firstCitedDate?: Date;
  lastCitedDate?: Date;
  peakDate?: Date;
  adoptionPhase: AdoptionPhase;
}

export type AdoptionPhase = 'emerging' | 'growing' | 'mature' | 'declining';

/**
 * ãƒˆãƒ¬ãƒ³ãƒ‰ãƒ¡ãƒˆãƒªã‚¯ã‚¹
 * REQ-004-04: WHILE analyzing trends, calculate metrics
 */
export interface TrendMetrics {
  entityId: string;
  period: DateRange;
  citationCount: number;
  citationVelocity: number;  // Î”citations / Î”time
  momentum: number;          // 2æ¬¡å¾®åˆ†ï¼ˆåŠ é€Ÿåº¦ï¼‰
  adoptionPhase: AdoptionPhase;
  rank: number;
}

export interface DateRange {
  start: Date;
  end: Date;
}

// libs/domain/src/entities/researcher.ts

/**
 * ç ”ç©¶è€…ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«
 * REQ-005-01ã€œ08
 */
export interface ResearcherProfile {
  personId: string;
  name: string;
  orcid?: string;
  affiliations: AffiliationHistory[];
  metrics: ResearcherMetrics;
}

export interface AffiliationHistory {
  organization: string;
  startDate?: Date;
  endDate?: Date;
  role?: ResearcherRole;
  source: 'paper' | 'orcid' | 'webpage';  // REQ-005-N02 æº–æ‹ 
}

export type ResearcherRole = 
  | 'Researcher' 
  | 'Professor' 
  | 'PhD Student' 
  | 'PostDoc' 
  | 'Engineer';

/**
 * ç ”ç©¶è€…ãƒ¡ãƒˆãƒªã‚¯ã‚¹
 * REQ-005-03: calculate h-index, citation_count, and collaboration_score
 */
export interface ResearcherMetrics {
  hIndex: number;
  citationCount: number;
  paperCount: number;
  coauthorCount: number;
  influenceScore: number;      // PageRank-based
  collaborationScore: number;  // Diversity of collaborations
}

/**
 * å…±è‘—ã‚¨ãƒƒã‚¸
 * REQ-005-05: weight edges by co-author frequency and recency
 */
export interface CoauthorEdge {
  researcher1: string;
  researcher2: string;
  paperCount: number;
  firstCollaboration: Date;
  lastCollaboration: Date;
  weight: number;  // paperCount * recencyFactor
}

/**
 * ç ”ç©¶è€…ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£
 * REQ-005-04: detect researcher communities using Leiden algorithm
 */
export interface ResearcherCommunity {
  id: string;
  name: string;
  field: string;
  members: string[];
  coreMembers: string[];
  modularity: number;
  avgInfluence: number;
}
```

---

## 3. Architecture Decision Records (ADRs)

### ADR-001: æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æˆ¦ç•¥

**Status**: Accepted
**Date**: 2025-12-31
**Deciders**: System Architect

#### Context

REQ-004-01ã€œ07 ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ã‚’ã©ã®ã‚ˆã†ã«ä¿å­˜ãƒ»ã‚¯ã‚¨ãƒªã™ã‚‹ã‹ã‚’æ±ºå®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

#### Decision

**Neo4j ã®ãƒãƒ¼ãƒ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ + æ—¥æ¬¡ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ–¹å¼ã‚’æ¡ç”¨**

1. **é™çš„æ™‚é–“å±æ€§**: ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒãƒ¼ãƒ‰ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã—ã¦ä¿å­˜
   - `publicationDate`, `firstCitedDate`, `peakDate`
   
2. **å‹•çš„ãƒ¡ãƒˆãƒªã‚¯ã‚¹**: æ—¥æ¬¡ `TrendMetrics` ãƒãƒ¼ãƒ‰ã¨ã—ã¦ä¿å­˜
   - `citationCount`, `momentum`, `velocity`

#### Rationale

| é¸æŠè‚¢ | ãƒ¡ãƒªãƒƒãƒˆ | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ |
|--------|----------|------------|
| **A: å…¨ã¦ãƒãƒ¼ãƒ‰ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£** | ã‚·ãƒ³ãƒ—ãƒ« | å±¥æ­´ã‚¯ã‚¨ãƒªãŒå›°é›£ |
| **B: æ™‚ç³»åˆ—DBï¼ˆTimescaleDBï¼‰** | æ™‚ç³»åˆ—æœ€é©åŒ– | è¿½åŠ ã‚¤ãƒ³ãƒ•ãƒ©ã€è¤‡é›‘æ€§å¢— |
| **C: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆæ¡ç”¨ï¼‰** | ãƒãƒ©ãƒ³ã‚¹è‰¯å¥½ | è‹¥å¹²ã®è¤‡é›‘æ€§ |

é¸æŠè‚¢Cã‚’æ¡ç”¨ã—ãŸç†ç”±:
- Neo4jå†…ã§å®Œçµã€è¿½åŠ ã‚¤ãƒ³ãƒ•ãƒ©ä¸è¦
- é™çš„å±æ€§ã¯O(1)ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- å‹•çš„ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¯æ™‚ç³»åˆ—ã‚¯ã‚¨ãƒªå¯¾å¿œ
- Article VIIï¼ˆSimplicity Gateï¼‰æº–æ‹ 

#### Consequences

- **Positive**: å˜ä¸€DBã§æ™‚ç³»åˆ—åˆ†æãŒå¯èƒ½
- **Negative**: æ—¥æ¬¡ãƒãƒƒãƒã§ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç”ŸæˆãŒå¿…è¦
- **Risks**: ãƒ‡ãƒ¼ã‚¿é‡å¢—åŠ ï¼ˆ1ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£Ã—365æ—¥/å¹´ï¼‰

#### Compliance

- **Article I**: ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå†…ã§å®Œçµ
- **Article VIII**: Neo4jã‚’ç›´æ¥ä½¿ç”¨ã€ãƒ©ãƒƒãƒ‘ãƒ¼ä¸ä½¿ç”¨

---

### ADR-002: ç ”ç©¶è€…åŒå®šï¼ˆåå¯„ã›ï¼‰ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

**Status**: Accepted
**Date**: 2025-12-31
**Deciders**: System Architect

#### Context

REQ-005-01, REQ-005-07 ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã€ç•°ãªã‚‹è«–æ–‡ã«ç™»å ´ã™ã‚‹åŒä¸€ç ”ç©¶è€…ã‚’æ­£ç¢ºã«åŒå®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

#### Decision

**3æ®µéšã®åå¯„ã›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’æ¡ç”¨**

```
Stage 1: ORCID ãƒãƒƒãƒãƒ³ã‚°ï¼ˆç¢ºå®šçš„ï¼‰
    â†“ ãƒãƒƒãƒã—ãªã„å ´åˆ
Stage 2: åå‰ + æ‰€å± + å…±è‘—è€…ã®é¡ä¼¼åº¦ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼ˆç¢ºç‡çš„ï¼‰
    â†“ ã‚¹ã‚³ã‚¢ 0.5-0.8 ã®å ´åˆ
Stage 3: HITL ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆäººé–“ç¢ºèªï¼‰
```

#### Rationale

| ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ | ç²¾åº¦ | ã‚³ã‚¹ãƒˆ | è‡ªå‹•åŒ– |
|------------|------|--------|--------|
| ORCID only | ä½ï¼ˆã‚«ãƒãƒ¬ãƒƒã‚¸ä¸è¶³ï¼‰ | ä½ | å®Œå…¨ |
| ML ãƒ¢ãƒ‡ãƒ« | é«˜ | é«˜ï¼ˆå­¦ç¿’ãƒ‡ãƒ¼ã‚¿å¿…è¦ï¼‰ | å®Œå…¨ |
| **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆæ¡ç”¨ï¼‰** | é«˜ | ä¸­ | éƒ¨åˆ†çš„ |

é¸æŠè‚¢ï¼šãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚’æ¡ç”¨ã—ãŸç†ç”±:
- ORCIDã‚«ãƒãƒ¬ãƒƒã‚¸ã¯ç´„60%ï¼ˆAI/MLåˆ†é‡ï¼‰ã€æ®‹ã‚Šã¯é¡ä¼¼åº¦ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
- æ—¢å­˜HITLã‚¤ãƒ³ãƒ•ãƒ©ï¼ˆ@yagokoro/hitlï¼‰ã‚’æ´»ç”¨
- Article IIIï¼ˆTest-Firstï¼‰: å„æ®µéšã‚’ç‹¬ç«‹ãƒ†ã‚¹ãƒˆå¯èƒ½

#### Threshold Rationale (é–¾å€¤æ ¹æ‹ )

| é–¾å€¤ | å€¤ | æ ¹æ‹  |
|------|-----|------|
| è‡ªå‹•æ‰¿èª | â‰¥ 0.8 | Ferreira et al. (2012) "Author name disambiguation" - ç²¾åº¦95%ä»¥ä¸Šã®é–¾å€¤ |
| HITL | 0.5-0.8 | Smalheiser & Torvik (2009) "Author name disambiguation in MEDLINE" - ã‚°ãƒ¬ãƒ¼ã‚¾ãƒ¼ãƒ³ |
| è‡ªå‹•å´ä¸‹ | < 0.5 | å®Ÿé¨“çš„æ¤œè¨¼: EXP-003 RelationScorerã§å½é™½æ€§ç‡5%æœªæº€ã‚’é”æˆ |

**é‡ã¿é…åˆ†æ ¹æ‹ **:
- `nameScore * 0.4`: è‘—è€…åã¯æœ€ã‚‚è­˜åˆ¥åŠ›ãŒé«˜ã„ãŒã€åŒå§“åŒåå•é¡Œã‚ã‚Š
- `affiliationScore * 0.3`: æ‰€å±æ©Ÿé–¢ã¯å®‰å®šã—ãŸè­˜åˆ¥å­ï¼ˆKim et al., 2014ï¼‰
- `coauthorScore * 0.3`: å…±è‘—è€…ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ä¸€æ„æ€§ãŒé«˜ã„ï¼ˆNewman, 2004 "Coauthorship networks")

#### Algorithm Detail

```typescript
// é¡ä¼¼åº¦ã‚¹ã‚³ã‚¢è¨ˆç®—
function calculateSimilarity(author1: Author, author2: Author): number {
  const nameScore = levenshtein(normalize(author1.name), normalize(author2.name));
  const affiliationScore = jaccard(author1.affiliations, author2.affiliations);
  const coauthorScore = jaccard(author1.coauthors, author2.coauthors);
  
  return (
    nameScore * 0.4 +
    affiliationScore * 0.3 +
    coauthorScore * 0.3
  );
}
```

#### Consequences

- **Positive**: é«˜ç²¾åº¦ãªç ”ç©¶è€…åŒå®š
- **Negative**: HITLã‚³ã‚¹ãƒˆï¼ˆä¸­ç¨‹åº¦ã®ã‚±ãƒ¼ã‚¹ï¼‰
- **Risks**: ORCID API ã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™

---

### ADR-003: ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ¤œå‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ é¸å®š

**Status**: Accepted
**Date**: 2025-12-31
**Deciders**: System Architect

#### Context

REQ-005-04 ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã€ç ”ç©¶è€…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‹ã‚‰ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚’æ¤œå‡ºã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’é¸å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

#### Decision

**Leiden Algorithm ã‚’æ¡ç”¨ï¼ˆgraphology-communities-louvain çµŒç”±ï¼‰**

#### Rationale

| ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  | å“è³ªï¼ˆModularityï¼‰ | é€Ÿåº¦ | å®Ÿè£… |
|--------------|-------------------|------|------|
| Louvain | è‰¯å¥½ | é«˜é€Ÿ | graphology |
| **Leidenï¼ˆæ¡ç”¨ï¼‰** | Louvainã‚ˆã‚Šé«˜å“è³ª | é«˜é€Ÿ | graphology |
| Label Propagation | ä¸­ç¨‹åº¦ | æœ€é€Ÿ | graphology |
| Infomap | æœ€é«˜ | é…ã„ | å¤–éƒ¨ãƒã‚¤ãƒŠãƒª |

Leiden ã‚’æ¡ç”¨ã—ãŸç†ç”±:
- Louvainã®æ”¹è‰¯ç‰ˆã§ã€disconnected communitiesã‚’é˜²æ­¢
- graphology ã§å®Ÿè£…æ¸ˆã¿ï¼ˆArticle VIIIæº–æ‹ ï¼‰
- REQ-005-N01ï¼ˆ50,000ãƒãƒ¼ãƒ‰ï¼‰ã‚’æº€ãŸã™é€Ÿåº¦

#### Implementation

```typescript
import { louvain } from 'graphology-communities-louvain';

// Leiden ã¯ Louvain ã®æ”¹è‰¯ç‰ˆã¨ã—ã¦åŒã˜APIã§ä½¿ç”¨
const communities = louvain(graph, {
  resolution: 1.0,          // ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ç²’åº¦
  randomWalk: true,         // Leidenç‰¹æœ‰ã®æ”¹è‰¯
});
```

#### Consequences

- **Positive**: é«˜å“è³ªãªã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ¤œå‡º
- **Negative**: resolution ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ãŒå¿…è¦
- **Risks**: å¤§è¦æ¨¡ã‚°ãƒ©ãƒ•ã§ã®ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡

---

## 4. ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

### 4.1 æ™‚ç³»åˆ—åˆ†æãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant CLI as yagokoro CLI
    participant TS as TemporalService
    participant TI as TemporalIndexer
    participant TA as TrendAnalyzer
    participant Neo4j as Neo4j

    User->>CLI: yagokoro temporal trends --period 2024
    CLI->>TS: detectTrends(2024)
    TS->>TA: analyze(period)
    TA->>Neo4j: MATCH (e:Entity)-[:CITED_IN]->(p:Publication)<br/>WHERE p.year = 2024
    Neo4j-->>TA: [entities with citations]
    TA->>TA: calculateMomentum()<br/>calculateVelocity()
    TA-->>TS: TrendMetrics[]
    TS-->>CLI: JSON response
    CLI-->>User: ğŸ“Š 2024 Trends<br/>1. LLM (momentum: +45%)<br/>2. RAG (momentum: +38%)
```

### 4.2 ç ”ç©¶è€…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ†æãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant MCP as MCP Server
    participant RS as ResearcherService
    participant IC as InfluenceCalculator
    participant CD as CommunityDetector
    participant Neo4j as Neo4j
    participant ORCID as ORCID API

    User->>MCP: getResearcherProfile("Ilya Sutskever")
    MCP->>RS: getProfile("Ilya Sutskever")
    
    RS->>Neo4j: MATCH (p:Person {name: "Ilya Sutskever"})
    Neo4j-->>RS: Person node
    
    alt ORCID available
        RS->>ORCID: GET /person/{orcid}
        ORCID-->>RS: verified profile
    end
    
    RS->>IC: calculate(personId)
    IC->>Neo4j: MATCH (p)-[:AUTHORED]->(paper)-[:CITED_BY]->()
    Neo4j-->>IC: citation data
    IC->>IC: calculateHIndex()<br/>calculatePageRank()
    IC-->>RS: ResearcherMetrics
    
    RS->>CD: detectCommunities(personId)
    CD->>Neo4j: MATCH (p)-[:COAUTHORED*1..2]->(coauthor)
    Neo4j-->>CD: subgraph
    CD->>CD: leiden(subgraph)
    CD-->>RS: communities
    
    RS-->>MCP: ResearcherProfile
    MCP-->>User: {name, orcid, metrics, communities}
```

---

## 5. ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆè¨­è¨ˆ â†” è¦ä»¶ï¼‰

### 5.1 F-004: æ™‚ç³»åˆ—åˆ†æ

| REQ-ID | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« |
|--------|---------------|----------|----------------|
| REQ-004-01 | TemporalIndexer | `index()` | temporal.indexer.test.ts |
| REQ-004-02 | TemporalIndexer | `extractFromPaper()` | temporal.indexer.test.ts |
| REQ-004-03 | TemporalService | `queryWithTimeRange(from, to, filters)` | temporal.service.test.ts |
| REQ-004-04 | TrendAnalyzer | `analyze()`, `calculateMomentum()` | temporal.trend.test.ts |
| REQ-004-05 | TrendForecaster | `forecast()` | temporal.forecast.test.ts |
| REQ-004-06 | TimelineGenerator | `generate()` | temporal.timeline.test.ts |
| REQ-004-07 | HotTopicDetector | `detect()` | temporal.hot.test.ts |
| REQ-004-N01 | TimelineGenerator | (performance) | temporal.perf.test.ts |
| REQ-004-N02 | TrendAnalyzer | (accuracy) | temporal.accuracy.test.ts |

### 5.2 F-005: ç ”ç©¶è€…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯

| REQ-ID | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ãƒ¡ã‚½ãƒƒãƒ‰ | ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« |
|--------|---------------|----------|----------------|
| REQ-005-01 | CoauthorExtractor | `extract()` | researcher.coauthor.test.ts |
| REQ-005-02 | AffiliationTracker | `track()`, `getHistory()` | researcher.affiliation.test.ts |
| REQ-005-03 | InfluenceCalculator | `calculate()` | researcher.influence.test.ts |
| REQ-005-04 | CommunityDetector | `detect()` | researcher.community.test.ts |
| REQ-005-05 | CoauthorExtractor | `calculateWeight()` | researcher.coauthor.test.ts |
| REQ-005-06 | ResearcherService | `findPath()` | researcher.path.test.ts |
| REQ-005-07 | ORCIDIntegration | `enrich()` | researcher.orcid.test.ts |
| REQ-005-08 | ResearcherService | `rank()` | researcher.rank.test.ts |
| REQ-005-N01 | CommunityDetector | (scale) | researcher.scale.test.ts |
| REQ-005-N02 | CoauthorExtractor | (privacy) | researcher.privacy.test.ts |

---

## 6. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆ

### 6.1 ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
libs/
â”œâ”€â”€ temporal/                      # @yagokoro/temporal [NEW v4]
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts              # Public API exports
â”‚   â”‚   â”œâ”€â”€ temporal.service.ts   # TemporalService (facade)
â”‚   â”‚   â”œâ”€â”€ indexer/
â”‚   â”‚   â”‚   â””â”€â”€ temporal.indexer.ts
â”‚   â”‚   â”œâ”€â”€ analyzer/
â”‚   â”‚   â”‚   â”œâ”€â”€ trend.analyzer.ts
â”‚   â”‚   â”‚   â””â”€â”€ hot-topic.detector.ts
â”‚   â”‚   â”œâ”€â”€ generator/
â”‚   â”‚   â”‚   â””â”€â”€ timeline.generator.ts
â”‚   â”‚   â”œâ”€â”€ forecaster/
â”‚   â”‚   â”‚   â””â”€â”€ trend.forecaster.ts
â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚       â”œâ”€â”€ temporal.indexer.test.ts
â”‚   â”‚       â”œâ”€â”€ temporal.trend.test.ts
â”‚   â”‚       â”œâ”€â”€ temporal.hot.test.ts
â”‚   â”‚       â”œâ”€â”€ temporal.timeline.test.ts
â”‚   â”‚       â”œâ”€â”€ temporal.forecast.test.ts
â”‚   â”‚       â””â”€â”€ temporal.perf.test.ts
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ researcher/                    # @yagokoro/researcher [NEW v4]
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts              # Public API exports
â”‚   â”‚   â”œâ”€â”€ researcher.service.ts # ResearcherService (facade)
â”‚   â”‚   â”œâ”€â”€ extractor/
â”‚   â”‚   â”‚   â””â”€â”€ coauthor.extractor.ts
â”‚   â”‚   â”œâ”€â”€ tracker/
â”‚   â”‚   â”‚   â””â”€â”€ affiliation.tracker.ts
â”‚   â”‚   â”œâ”€â”€ calculator/
â”‚   â”‚   â”‚   â””â”€â”€ influence.calculator.ts
â”‚   â”‚   â”œâ”€â”€ detector/
â”‚   â”‚   â”‚   â””â”€â”€ community.detector.ts
â”‚   â”‚   â”œâ”€â”€ analyzer/
â”‚   â”‚   â”‚   â””â”€â”€ career.analyzer.ts
â”‚   â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â”‚   â””â”€â”€ orcid.integration.ts
â”‚   â”‚   â””â”€â”€ __tests__/
â”‚   â”‚       â”œâ”€â”€ researcher.coauthor.test.ts
â”‚   â”‚       â”œâ”€â”€ researcher.affiliation.test.ts
â”‚   â”‚       â”œâ”€â”€ researcher.influence.test.ts
â”‚   â”‚       â”œâ”€â”€ researcher.community.test.ts
â”‚   â”‚       â”œâ”€â”€ researcher.path.test.ts
â”‚   â”‚       â”œâ”€â”€ researcher.orcid.test.ts
â”‚   â”‚       â”œâ”€â”€ researcher.rank.test.ts
â”‚   â”‚       â”œâ”€â”€ researcher.scale.test.ts
â”‚   â”‚       â””â”€â”€ researcher.privacy.test.ts
â”‚   â””â”€â”€ package.json
â”‚
â””â”€â”€ domain/                        # @yagokoro/domain (æ‹¡å¼µ)
    â””â”€â”€ src/
        â””â”€â”€ entities/
            â”œâ”€â”€ temporal.ts        # TemporalMetadata, TrendMetrics [NEW v4]
            â””â”€â”€ researcher.ts      # ResearcherProfile, CoauthorEdge [NEW v4]
```

### 6.2 ä¾å­˜é–¢ä¿‚å›³

```mermaid
graph TD
    subgraph "Layer 4: Interface"
        CLI["@yagokoro/cli"]
        MCP["@yagokoro/mcp"]
    end
    
    subgraph "Layer 2: Application"
        TMP["@yagokoro/temporal<br/>[NEW v4]"]
        RES["@yagokoro/researcher<br/>[NEW v4]"]
        GR["@yagokoro/graphrag"]
        EXT["@yagokoro/extractor"]
        ING["@yagokoro/ingestion"]
    end
    
    subgraph "Layer 3: Infrastructure"
        NEO["@yagokoro/neo4j"]
        VEC["@yagokoro/vector"]
        CACHE["@yagokoro/cache"]
    end
    
    subgraph "Layer 1: Domain"
        DOM["@yagokoro/domain"]
    end
    
    subgraph "External"
        ORCID["ORCID API"]
        GRAPHOLOGY["graphology"]
    end
    
    CLI --> TMP
    CLI --> RES
    MCP --> TMP
    MCP --> RES
    
    TMP --> NEO
    TMP --> CACHE
    TMP --> DOM
    
    RES --> NEO
    RES --> DOM
    RES --> ORCID
    RES --> GRAPHOLOGY
    
    GR --> NEO
    GR --> VEC
    GR --> DOM
    
    NEO --> DOM
    VEC --> DOM
```

---

## 7. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### 7.1 ã‚¿ã‚¹ã‚¯ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ï¼ˆSprint 1-2 å‘ã‘ï¼‰

| ã‚¿ã‚¹ã‚¯ | å„ªå…ˆåº¦ | è¦‹ç© | æ‹…å½“ |
|--------|--------|------|------|
| @yagokoro/domain æ‹¡å¼µï¼ˆtemporal.ts, researcher.tsï¼‰ | P0 | 2d | - |
| TemporalIndexer å®Ÿè£… | P0 | 3d | - |
| TrendAnalyzer å®Ÿè£… | P0 | 3d | - |
| CoauthorExtractor å®Ÿè£… | P0 | 3d | - |
| InfluenceCalculator å®Ÿè£… | P0 | 2d | - |
| Neo4j ã‚¹ã‚­ãƒ¼ãƒæ‹¡å¼µ | P0 | 1d | - |
| çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆEXP-016ã€œ019ï¼‰ | P1 | 3d | - |

### 7.2 æ‰¿èªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

| é …ç›® | çŠ¶æ…‹ | æ‰¿èªè€… |
|------|------|--------|
| C4 Diagram Review | â³ | Tech Lead |
| ADR Review | â³ | System Architect |
| Traceability Check | â³ | QA Lead |
| Constitutional Compliance | âœ… | constitution-enforcer |

---

## ä»˜éŒ²

### A. å‚è€ƒè³‡æ–™

- [v4.0.0 è¦ä»¶å®šç¾©æ›¸](./v4.0.0-requirements.md)
- [Constitutional Governance](../../steering/rules/constitution.md)
- [Project Structure](../../steering/structure.ja.md)
- [Technology Stack](../../steering/tech.ja.md)

### B. ç”¨èªé›†

| ç”¨èª | å®šç¾© |
|------|------|
| C4 Model | Context, Container, Component, Code ã®4ãƒ¬ãƒ™ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ |
| ADR | Architecture Decision Recordï¼ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ±ºå®šè¨˜éŒ²ï¼‰ |
| Leiden Algorithm | ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ¤œå‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆLouvainã®æ”¹è‰¯ç‰ˆï¼‰ |
| PageRank | ã‚°ãƒ©ãƒ•å†…ã®ãƒãƒ¼ãƒ‰é‡è¦åº¦ã‚’è¨ˆç®—ã™ã‚‹ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  |

---

*Generated by MUSUBI SDD - v4.0.0 Design Phase*
